import React, { createContext, useContext, useEffect, useState } from 'react';

export type Theme = 'light' | 'dark';

type ThemeContextValue = {
  theme: Theme;
  setTheme: (t: Theme) => void;
  toggleTheme: () => void;
};

const ThemeContext = createContext<ThemeContextValue | undefined>(undefined);

// Tailwind hints (use these in your components as shown in the README comment below):
// Dark -> Light swaps examples:
// - root: dark -> add `light` class on <html> (document.documentElement) or container to enable light-mode styles
// - container bg: dark `bg-gray-900` -> light `bg-gray-50`
// - card bg: dark `bg-gray-800 border border-gray-700` -> light `bg-white border border-gray-200`
// - text: dark `text-white` -> light `text-gray-900`
// - secondary text: dark `text-gray-400` -> light `text-gray-500`
// Example conditional usage in a component:
// const { theme } = useTheme();
// <div className={`${theme === 'light' ? 'bg-white text-gray-900' : 'bg-gray-900 text-white'}`}>...</div>

export const ThemeProvider: React.FC<{ children: React.ReactNode }> = ({ children }) => {
  const [theme, setThemeState] = useState<Theme>(() => {
    try {
      const saved = typeof window !== 'undefined' ? localStorage.getItem('theme') : null;
      return (saved as Theme) || 'dark';
    } catch (e) {
      return 'dark';
    }
  });

  useEffect(() => {
    try {
      localStorage.setItem('theme', theme);
    } catch (e) {
      // ignore
    }

    // Apply a `light` class to documentElement for global Tailwind variant control if desired
    if (typeof document !== 'undefined') {
      if (theme === 'light') {
        document.documentElement.classList.add('light');
        document.documentElement.classList.remove('dark-override');
      } else {
        document.documentElement.classList.remove('light');
        // optional marker for dark
        document.documentElement.classList.add('dark-override');
      }
    }
  }, [theme]);

  const setTheme = (t: Theme) => setThemeState(t);
  const toggleTheme = () => setThemeState((s) => (s === 'light' ? 'dark' : 'light'));

  return <ThemeContext.Provider value={{ theme, setTheme, toggleTheme }}>{children}</ThemeContext.Provider>;
};

export const useTheme = (): ThemeContextValue => {
  const ctx = useContext(ThemeContext);
  if (!ctx) throw new Error('useTheme must be used inside ThemeProvider');
  return ctx;
};

export default ThemeProvider;
