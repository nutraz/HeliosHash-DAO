name: CI Diagnostic
on: [push]
jobs:
  diagnose:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      - name: Print Git status
        run: |
          echo "git status:"; git status --porcelain || true
      - name: List top-level
        run: |
          echo "=== Current Structure ===";
          ls -la . || true;
          echo "\n=== Top-level dirs (depth=2) ===";
          find . -maxdepth 2 -type d | sort || true;
      - name: Workflows files
        run: |
          echo "=== Workflows ===";
          ls -la .github/workflows/ || true;
          echo "--- workflow contents (first 200 lines each) ---";
          for f in .github/workflows/*.{yml,yaml}; do
            echo "---- $f ----"; head -n 200 "$f" || true; echo; done
      - name: Apps and packages overview
        run: |
          echo "=== apps/ listing ==="; ls -la apps/ || echo "no apps/";
          echo "=== packages/ listing ==="; ls -la packages/ || echo "no packages/";
      - name: Print Node/DFX metadata
        run: |
          echo "node:"; node --version || true;
          echo "pnpm:"; pnpm --version || true;
          echo "dfx (if present):"; dfx --version || true
