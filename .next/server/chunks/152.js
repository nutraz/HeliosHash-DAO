"use strict";exports.id=152,exports.ids=[152],exports.modules={1152:(e,t,r)=>{r.d(t,{Actor:()=>Actor,HttpAgent:()=>HttpAgent});var i,n,a,s,o,c,l,u,d,f,h,p,y,m,g,v,T,C={};function isV2ResponseBody(e){return null!=e&&"reject_code"in e}function isV3ResponseBody(e){return null!=e&&"certificate"in e}r.r(C),r.d(C,{Bool:()=>z,BoolClass:()=>BoolClass,ConstructType:()=>ConstructType,Empty:()=>L,EmptyClass:()=>EmptyClass,FixedIntClass:()=>FixedIntClass,FixedNatClass:()=>FixedNatClass,Float32:()=>ei,Float64:()=>en,FloatClass:()=>FloatClass,Func:()=>Func,FuncClass:()=>FuncClass,Int:()=>ee,Int16:()=>es,Int32:()=>eo,Int64:()=>ec,Int8:()=>ea,IntClass:()=>IntClass,Nat:()=>er,Nat16:()=>eu,Nat32:()=>ed,Nat64:()=>ef,Nat8:()=>el,NatClass:()=>NatClass,Null:()=>Y,NullClass:()=>NullClass,Opt:()=>Opt,OptClass:()=>OptClass,PrimitiveType:()=>PrimitiveType,Principal:()=>eh,PrincipalClass:()=>PrincipalClass,Rec:()=>Rec,RecClass:()=>RecClass,Record:()=>Record,RecordClass:()=>RecordClass,Reserved:()=>K,ReservedClass:()=>ReservedClass,Service:()=>Service,ServiceClass:()=>ServiceClass,Text:()=>H,TextClass:()=>TextClass,Tuple:()=>Tuple,TupleClass:()=>TupleClass,Type:()=>Type,Unknown:()=>G,UnknownClass:()=>UnknownClass,Variant:()=>Variant,VariantClass:()=>VariantClass,Vec:()=>Vec,VecClass:()=>VecClass,Visitor:()=>Visitor,decode:()=>decode,encode:()=>encode,resetSubtypeCache:()=>resetSubtypeCache,subtype:()=>subtype}),function(e){e[e.SysFatal=1]="SysFatal",e[e.SysTransient=2]="SysTransient",e[e.DestinationInvalid=3]="DestinationInvalid",e[e.CanisterReject=4]="CanisterReject",e[e.CanisterError=5]="CanisterError"}(s||(s={})),function(e){e.Replied="replied",e.Rejected="rejected"}(o||(o={}));var S=r(278),O=r(2610),P=r(1070);function idlHash(e){let t=new TextEncoder,r=t.encode(e),i=0;for(let e of r)i=(223*i+e)%4294967296;return i}function idlLabelToId(e){if(/^_\d+_$/.test(e)||/^_0x[0-9a-fA-F]+_$/.test(e)){let t=+e.slice(1,-1);if(Number.isSafeInteger(t)&&t>=0&&t<4294967296)return t}return idlHash(e)}var A=r(9248),U=r(105);!function(e){e[e.Null=-1]="Null",e[e.Bool=-2]="Bool",e[e.Nat=-3]="Nat",e[e.Int=-4]="Int",e[e.Float32=-13]="Float32",e[e.Float64=-14]="Float64",e[e.Text=-15]="Text",e[e.Reserved=-16]="Reserved",e[e.Empty=-17]="Empty",e[e.Opt=-18]="Opt",e[e.Vector=-19]="Vector",e[e.Record=-20]="Record",e[e.Variant=-21]="Variant",e[e.Func=-22]="Func",e[e.Service=-23]="Service",e[e.Principal=-24]="Principal"}(c||(c={}));let D="DIDL";function zipWith(e,t,r){return e.map((e,i)=>r(e,t[i]))}let TypeTable=class TypeTable{constructor(){this._typs=[],this._idx=new Map,this._idxRefCount=new Map}has(e){return this._idx.has(e.name)}add(e,t){let r=this._typs.length;this._idx.set(e.name,r),this._idxRefCount.set(r,1),this._typs.push(t)}merge(e,t){let r=this._idx.get(e.name),i=this._idx.get(t);if(void 0===r)throw Error("Missing type index for "+e);if(void 0===i)throw Error("Missing type index for "+t);this._typs[r]=this._typs[i];let n=this._getIdxRefCount(r),a=this._getIdxRefCount(i);this._idxRefCount.set(r,n+a),this._idx.set(t,r),this._idxRefCount.set(i,0),this._compactFromEnd()}_getIdxRefCount(e){return this._idxRefCount.get(e)||0}_compactFromEnd(){for(;this._typs.length>0;){let e=this._typs.length-1;if(this._getIdxRefCount(e)>0)break;this._typs.pop(),this._idxRefCount.delete(e)}}encode(){let e=(0,A.dZ)(this._typs.length),t=(0,P.zo)(...this._typs);return(0,P.zo)(e,t)}indexOf(e){if(!this._idx.has(e))throw Error("Missing type index for "+e);return(0,A.nB)(this._idx.get(e)||0)}};let Visitor=class Visitor{visitType(e,t){throw Error("Not implemented")}visitPrimitive(e,t){return this.visitType(e,t)}visitEmpty(e,t){return this.visitPrimitive(e,t)}visitBool(e,t){return this.visitPrimitive(e,t)}visitNull(e,t){return this.visitPrimitive(e,t)}visitReserved(e,t){return this.visitPrimitive(e,t)}visitText(e,t){return this.visitPrimitive(e,t)}visitNumber(e,t){return this.visitPrimitive(e,t)}visitInt(e,t){return this.visitNumber(e,t)}visitNat(e,t){return this.visitNumber(e,t)}visitFloat(e,t){return this.visitPrimitive(e,t)}visitFixedInt(e,t){return this.visitNumber(e,t)}visitFixedNat(e,t){return this.visitNumber(e,t)}visitPrincipal(e,t){return this.visitPrimitive(e,t)}visitConstruct(e,t){return this.visitType(e,t)}visitVec(e,t,r){return this.visitConstruct(e,r)}visitOpt(e,t,r){return this.visitConstruct(e,r)}visitRecord(e,t,r){return this.visitConstruct(e,r)}visitTuple(e,t,r){let i=t.map((e,t)=>[`_${t}_`,e]);return this.visitRecord(e,i,r)}visitVariant(e,t,r){return this.visitConstruct(e,r)}visitRec(e,t,r){return this.visitConstruct(t,r)}visitFunc(e,t){return this.visitConstruct(e,t)}visitService(e,t){return this.visitConstruct(e,t)}};!function(e){e.EmptyClass="__IDL_EmptyClass__",e.UnknownClass="__IDL_UnknownClass__",e.BoolClass="__IDL_BoolClass__",e.NullClass="__IDL_NullClass__",e.ReservedClass="__IDL_ReservedClass__",e.TextClass="__IDL_TextClass__",e.IntClass="__IDL_IntClass__",e.NatClass="__IDL_NatClass__",e.FloatClass="__IDL_FloatClass__",e.FixedIntClass="__IDL_FixedIntClass__",e.FixedNatClass="__IDL_FixedNatClass__",e.VecClass="__IDL_VecClass__",e.OptClass="__IDL_OptClass__",e.RecordClass="__IDL_RecordClass__",e.TupleClass="__IDL_TupleClass__",e.VariantClass="__IDL_VariantClass__",e.RecClass="__IDL_RecClass__",e.PrincipalClass="__IDL_PrincipalClass__",e.FuncClass="__IDL_FuncClass__",e.ServiceClass="__IDL_ServiceClass__"}(l||(l={}));let Type=class Type{display(){return this.name}valueToString(e){return toReadableString(e)}buildTypeTable(e){e.has(this)||this._buildTypeTableImpl(e)}};let PrimitiveType=class PrimitiveType extends Type{checkType(e){if(this.name!==e.name)throw Error(`type mismatch: type on the wire ${e.name}, expect type ${this.name}`);return e}_buildTypeTableImpl(e){}};let ConstructType=class ConstructType extends Type{checkType(e){if(e instanceof RecClass){let t=e.getType();if(void 0===t)throw Error("type mismatch with uninitialized type");return t}throw Error(`type mismatch: type on the wire ${e.name}, expect type ${this.name}`)}encodeType(e){return e.indexOf(this.name)}};let EmptyClass=class EmptyClass extends PrimitiveType{get typeName(){return l.EmptyClass}static[Symbol.hasInstance](e){return e.typeName===l.EmptyClass}accept(e,t){return e.visitEmpty(this,t)}covariant(e){throw Error(`Invalid ${this.display()} argument: ${toReadableString(e)}`)}encodeValue(){throw Error("Empty cannot appear as a function argument")}valueToString(){throw Error("Empty cannot appear as a value")}encodeType(){return(0,A.nB)(c.Empty)}decodeValue(){throw Error("Empty cannot appear as an output")}get name(){return"empty"}};let UnknownClass=class UnknownClass extends Type{get typeName(){return l.UnknownClass}static[Symbol.hasInstance](e){return e.typeName===l.UnknownClass}checkType(e){throw Error("Method not implemented for unknown.")}accept(e,t){throw e.visitType(this,t)}covariant(e){throw Error(`Invalid ${this.display()} argument: ${toReadableString(e)}`)}encodeValue(){throw Error("Unknown cannot appear as a function argument")}valueToString(){throw Error("Unknown cannot appear as a value")}encodeType(){throw Error("Unknown cannot be serialized")}decodeValue(e,t){let r=t.decodeValue(e,t);return Object(r)!==r&&(r=Object(r)),Object.defineProperty(r,"type",{value:t instanceof RecClass?()=>t.getType():()=>t,writable:!0,enumerable:!1,configurable:!0}),r}_buildTypeTableImpl(){throw Error("Unknown cannot be serialized")}get name(){return"Unknown"}};let BoolClass=class BoolClass extends PrimitiveType{get typeName(){return l.BoolClass}static[Symbol.hasInstance](e){return e.typeName===l.BoolClass}accept(e,t){return e.visitBool(this,t)}covariant(e){if("boolean"==typeof e)return!0;throw Error(`Invalid ${this.display()} argument: ${toReadableString(e)}`)}encodeValue(e){return new Uint8Array([e?1:0])}encodeType(){return(0,A.nB)(c.Bool)}decodeValue(e,t){switch(this.checkType(t),(0,A.U1)(e)){case 0:return!1;case 1:return!0;default:throw Error("Boolean value out of range")}}get name(){return"bool"}};let NullClass=class NullClass extends PrimitiveType{get typeName(){return l.NullClass}static[Symbol.hasInstance](e){return e.typeName===l.NullClass}accept(e,t){return e.visitNull(this,t)}covariant(e){if(null===e)return!0;throw Error(`Invalid ${this.display()} argument: ${toReadableString(e)}`)}encodeValue(){return new Uint8Array(0)}encodeType(){return(0,A.nB)(c.Null)}decodeValue(e,t){return this.checkType(t),null}get name(){return"null"}};let ReservedClass=class ReservedClass extends PrimitiveType{get typeName(){return l.ReservedClass}static[Symbol.hasInstance](e){return e.typeName===l.ReservedClass}accept(e,t){return e.visitReserved(this,t)}covariant(e){return!0}encodeValue(){return new Uint8Array(0)}encodeType(){return(0,A.nB)(c.Reserved)}decodeValue(e,t){return t.name!==this.name&&t.decodeValue(e,t),null}get name(){return"reserved"}};let TextClass=class TextClass extends PrimitiveType{get typeName(){return l.TextClass}static[Symbol.hasInstance](e){return e.typeName===l.TextClass}accept(e,t){return e.visitText(this,t)}covariant(e){if("string"==typeof e)return!0;throw Error(`Invalid ${this.display()} argument: ${toReadableString(e)}`)}encodeValue(e){let t=new TextEncoder().encode(e),r=(0,A.dZ)(t.byteLength);return(0,P.zo)(r,t)}encodeType(){return(0,A.nB)(c.Text)}decodeValue(e,t){this.checkType(t);let r=(0,A.aC)(e),i=(0,A.DM)(e,Number(r)),n=new TextDecoder("utf8",{fatal:!0});return n.decode(i)}get name(){return"text"}valueToString(e){return'"'+e+'"'}};let IntClass=class IntClass extends PrimitiveType{get typeName(){return l.IntClass}static[Symbol.hasInstance](e){return e.typeName===l.IntClass}accept(e,t){return e.visitInt(this,t)}covariant(e){if("bigint"==typeof e||Number.isInteger(e))return!0;throw Error(`Invalid ${this.display()} argument: ${toReadableString(e)}`)}encodeValue(e){return(0,A.nB)(e)}encodeType(){return(0,A.nB)(c.Int)}decodeValue(e,t){return this.checkType(t),(0,A.WB)(e)}get name(){return"int"}valueToString(e){return e.toString()}};let NatClass=class NatClass extends PrimitiveType{get typeName(){return l.NatClass}static[Symbol.hasInstance](e){return e.typeName===l.NatClass}accept(e,t){return e.visitNat(this,t)}covariant(e){if("bigint"==typeof e&&e>=BigInt(0)||Number.isInteger(e)&&e>=0)return!0;throw Error(`Invalid ${this.display()} argument: ${toReadableString(e)}`)}encodeValue(e){return(0,A.dZ)(e)}encodeType(){return(0,A.nB)(c.Nat)}decodeValue(e,t){return this.checkType(t),(0,A.aC)(e)}get name(){return"nat"}valueToString(e){return e.toString()}};let FloatClass=class FloatClass extends PrimitiveType{get typeName(){return l.FloatClass}static[Symbol.hasInstance](e){return e.typeName===l.FloatClass}constructor(e){if(super(),this._bits=e,32!==e&&64!==e)throw Error("not a valid float type")}accept(e,t){return e.visitFloat(this,t)}covariant(e){if("number"==typeof e||e instanceof Number)return!0;throw Error(`Invalid ${this.display()} argument: ${toReadableString(e)}`)}encodeValue(e){let t=new ArrayBuffer(this._bits/8),r=new DataView(t);return 32===this._bits?r.setFloat32(0,e,!0):r.setFloat64(0,e,!0),new Uint8Array(t)}encodeType(){let e=32===this._bits?c.Float32:c.Float64;return(0,A.nB)(e)}decodeValue(e,t){this.checkType(t);let r=(0,A.DM)(e,this._bits/8),i=(0,P.rQ)(r);return 32===this._bits?i.getFloat32(0,!0):i.getFloat64(0,!0)}get name(){return"float"+this._bits}valueToString(e){return e.toString()}};let FixedIntClass=class FixedIntClass extends PrimitiveType{get typeName(){return l.FixedIntClass}static[Symbol.hasInstance](e){return e.typeName===l.FixedIntClass}constructor(e){super(),this._bits=e}accept(e,t){return e.visitFixedInt(this,t)}covariant(e){let t=(0,U.m)(this._bits-1)*BigInt(-1),r=(0,U.m)(this._bits-1)-BigInt(1),i=!1;if("bigint"==typeof e)i=e>=t&&e<=r;else if(Number.isInteger(e)){let n=BigInt(e);i=n>=t&&n<=r}else i=!1;if(i)return!0;throw Error(`Invalid ${this.display()} argument: ${toReadableString(e)}`)}encodeValue(e){return(0,A.VB)(e,this._bits/8)}encodeType(){let e=Math.log2(this._bits)-3;return(0,A.nB)(-9-e)}decodeValue(e,t){this.checkType(t);let r=(0,A.dz)(e,this._bits/8);return this._bits<=32?Number(r):r}get name(){return`int${this._bits}`}valueToString(e){return e.toString()}};let FixedNatClass=class FixedNatClass extends PrimitiveType{get typeName(){return l.FixedNatClass}static[Symbol.hasInstance](e){return e.typeName===l.FixedNatClass}constructor(e){super(),this._bits=e}accept(e,t){return e.visitFixedNat(this,t)}covariant(e){let t=(0,U.m)(this._bits),r=!1;if("bigint"==typeof e&&e>=BigInt(0))r=e<t;else if(Number.isInteger(e)&&e>=0){let i=BigInt(e);r=i<t}else r=!1;if(r)return!0;throw Error(`Invalid ${this.display()} argument: ${toReadableString(e)}`)}encodeValue(e){return(0,A.nE)(e,this._bits/8)}encodeType(){let e=Math.log2(this._bits)-3;return(0,A.nB)(-5-e)}decodeValue(e,t){this.checkType(t);let r=(0,A.Lu)(e,this._bits/8);return this._bits<=32?Number(r):r}get name(){return`nat${this._bits}`}valueToString(e){return e.toString()}};let VecClass=class VecClass extends ConstructType{get typeName(){return l.VecClass}static[Symbol.hasInstance](e){return e.typeName===l.VecClass}constructor(e){super(),this._type=e,this._blobOptimization=!1,e instanceof FixedNatClass&&8===e._bits&&(this._blobOptimization=!0)}accept(e,t){return e.visitVec(this,this._type,t)}covariant(e){let t=this._type instanceof FixedNatClass?this._type._bits:this._type instanceof FixedIntClass?this._type._bits:0;if(ArrayBuffer.isView(e)&&t==8*e.BYTES_PER_ELEMENT||Array.isArray(e)&&e.every((e,t)=>{try{return this._type.covariant(e)}catch(e){throw Error(`Invalid ${this.display()} argument: 

index ${t} -> ${e.message}`)}}))return!0;throw Error(`Invalid ${this.display()} argument: ${toReadableString(e)}`)}encodeValue(e){let t=(0,A.dZ)(e.length);if(this._blobOptimization)return(0,P.zo)(t,new Uint8Array(e));if(ArrayBuffer.isView(e)){if(e instanceof Int16Array||e instanceof Uint16Array){let r=new DataView(new ArrayBuffer(2*e.length));for(let t=0;t<e.length;t++)e instanceof Int16Array?r.setInt16(2*t,e[t],!0):r.setUint16(2*t,e[t],!0);return(0,P.zo)(t,new Uint8Array(r.buffer))}if(e instanceof Int32Array||e instanceof Uint32Array){let r=new DataView(new ArrayBuffer(4*e.length));for(let t=0;t<e.length;t++)e instanceof Int32Array?r.setInt32(4*t,e[t],!0):r.setUint32(4*t,e[t],!0);return(0,P.zo)(t,new Uint8Array(r.buffer))}{if(!(e instanceof BigInt64Array||e instanceof BigUint64Array))return(0,P.zo)(t,new Uint8Array(e.buffer,e.byteOffset,e.byteLength));let r=new DataView(new ArrayBuffer(8*e.length));for(let t=0;t<e.length;t++)e instanceof BigInt64Array?r.setBigInt64(8*t,e[t],!0):r.setBigUint64(8*t,e[t],!0);return(0,P.zo)(t,new Uint8Array(r.buffer))}}let r=new P.P8(new Uint8Array(t.byteLength+e.length),0);for(let i of(r.write(t),e)){let e=this._type.encodeValue(i);r.write(new Uint8Array(e))}return r.buffer}_buildTypeTableImpl(e){this._type.buildTypeTable(e);let t=(0,A.nB)(c.Vector),r=this._type.encodeType(e);e.add(this,(0,P.zo)(t,r))}decodeValue(e,t){let r=this.checkType(t);if(!(r instanceof VecClass))throw Error("Not a vector type");let i=Number((0,A.aC)(e));if(this._type instanceof FixedNatClass){if(8==this._type._bits)return new Uint8Array(e.read(i));if(16==this._type._bits){let t=e.read(2*i),r=new Uint16Array(t.buffer,t.byteOffset,i);return r}if(32==this._type._bits){let t=e.read(4*i),r=new Uint32Array(t.buffer,t.byteOffset,i);return r}if(64==this._type._bits)return new BigUint64Array(e.read(8*i).buffer)}if(this._type instanceof FixedIntClass){if(8==this._type._bits)return new Int8Array(e.read(i));if(16==this._type._bits){let t=e.read(2*i),r=new DataView(t.buffer,t.byteOffset,t.byteLength),n=new Int16Array(i);for(let e=0;e<i;e++)n[e]=r.getInt16(2*e,!0);return n}if(32==this._type._bits){let t=e.read(4*i),r=new DataView(t.buffer,t.byteOffset,t.byteLength),n=new Int32Array(i);for(let e=0;e<i;e++)n[e]=r.getInt32(4*e,!0);return n}if(64==this._type._bits){let t=e.read(8*i),r=new DataView(t.buffer,t.byteOffset,t.byteLength),n=new BigInt64Array(i);for(let e=0;e<i;e++)n[e]=r.getBigInt64(8*e,!0);return n}}let n=[];for(let t=0;t<i;t++)n.push(this._type.decodeValue(e,r._type));return n}get name(){return`vec ${this._type.name}`}display(){return`vec ${this._type.display()}`}valueToString(e){let t=e.map(e=>this._type.valueToString(e));return"vec {"+t.join("; ")+"}"}};let OptClass=class OptClass extends ConstructType{get typeName(){return l.OptClass}static[Symbol.hasInstance](e){return e.typeName===l.OptClass}constructor(e){super(),this._type=e}accept(e,t){return e.visitOpt(this,this._type,t)}covariant(e){try{if(Array.isArray(e)&&(0===e.length||1===e.length&&this._type.covariant(e[0])))return!0}catch(t){throw Error(`Invalid ${this.display()} argument: ${toReadableString(e)} 

-> ${t.message}`)}throw Error(`Invalid ${this.display()} argument: ${toReadableString(e)}`)}encodeValue(e){return 0===e.length?new Uint8Array([0]):(0,P.zo)(new Uint8Array([1]),this._type.encodeValue(e[0]))}_buildTypeTableImpl(e){this._type.buildTypeTable(e);let t=(0,A.nB)(c.Opt),r=this._type.encodeType(e);e.add(this,(0,P.zo)(t,r))}decodeValue(e,t){if(t instanceof NullClass||t instanceof ReservedClass)return[];let r=t;if(t instanceof RecClass){let e=t.getType();if(void 0===e)throw Error("type mismatch with uninitialized type");r=e}if(r instanceof OptClass)switch((0,A.U1)(e)){case 0:return[];case 1:{let t=e.save();try{let t=this._type.decodeValue(e,r._type);return[t]}catch(i){return e.restore(t),r._type.decodeValue(e,r._type),[]}}default:throw Error("Not an option value")}else{if(this._type instanceof NullClass||this._type instanceof OptClass||this._type instanceof ReservedClass)return r.decodeValue(e,r),[];let i=e.save();try{let r=this._type.decodeValue(e,t);return[r]}catch(n){return e.restore(i),r.decodeValue(e,t),[]}}}get name(){return`opt ${this._type.name}`}display(){return`opt ${this._type.display()}`}valueToString(e){return 0===e.length?"null":`opt ${this._type.valueToString(e[0])}`}};let RecordClass=class RecordClass extends ConstructType{get typeName(){return l.RecordClass}static[Symbol.hasInstance](e){return e.typeName===l.RecordClass||e.typeName===l.TupleClass}constructor(e={}){super(),this._fields=Object.entries(e).sort((e,t)=>idlLabelToId(e[0])-idlLabelToId(t[0]))}accept(e,t){return e.visitRecord(this,this._fields,t)}tryAsTuple(){let e=[];for(let t=0;t<this._fields.length;t++){let[r,i]=this._fields[t];if(r!==`_${t}_`)return null;e.push(i)}return e}covariant(e){if("object"==typeof e&&this._fields.every(([t,r])=>{if(!e.hasOwnProperty(t))throw Error(`Record is missing key "${t}".`);try{return r.covariant(e[t])}catch(e){throw Error(`Invalid ${this.display()} argument: 

field ${t} -> ${e.message}`)}}))return!0;throw Error(`Invalid ${this.display()} argument: ${toReadableString(e)}`)}encodeValue(e){let t=this._fields.map(([t])=>e[t]),r=zipWith(this._fields,t,([,e],t)=>e.encodeValue(t));return(0,P.zo)(...r)}_buildTypeTableImpl(e){this._fields.forEach(([t,r])=>r.buildTypeTable(e));let t=(0,A.nB)(c.Record),r=(0,A.dZ)(this._fields.length),i=this._fields.map(([t,r])=>(0,P.zo)((0,A.dZ)(idlLabelToId(t)),r.encodeType(e)));e.add(this,(0,P.zo)(t,r,(0,P.zo)(...i)))}decodeValue(e,t){let r=this.checkType(t);if(!(r instanceof RecordClass))throw Error("Not a record type");let i={},n=0,a=0;for(;a<r._fields.length;){let[t,s]=r._fields[a];if(n>=this._fields.length){s.decodeValue(e,s),a++;continue}let[o,c]=this._fields[n],l=idlLabelToId(this._fields[n][0]),u=idlLabelToId(t);if(l===u)i[o]=c.decodeValue(e,s),n++,a++;else if(u>l){if(c instanceof OptClass||c instanceof ReservedClass)i[o]=[],n++;else throw Error("Cannot find required field "+o)}else s.decodeValue(e,s),a++}for(let[e,t]of this._fields.slice(n))if(t instanceof OptClass||t instanceof ReservedClass)i[e]=[];else throw Error("Cannot find required field "+e);return i}get fieldsAsObject(){let e={};for(let[t,r]of this._fields)e[idlLabelToId(t)]=r;return e}get name(){let e=this._fields.map(([e,t])=>e+":"+t.name);return`record {${e.join("; ")}}`}display(){let e=this._fields.map(([e,t])=>e+":"+t.display());return`record {${e.join("; ")}}`}valueToString(e){let t=this._fields.map(([t])=>e[t]),r=zipWith(this._fields,t,([e,t],r)=>e+"="+t.valueToString(r));return`record {${r.join("; ")}}`}};let TupleClass=class TupleClass extends RecordClass{get typeName(){return l.TupleClass}static[Symbol.hasInstance](e){return e.typeName===l.TupleClass}constructor(e){let t={};e.forEach((e,r)=>t["_"+r+"_"]=e),super(t),this._components=e}accept(e,t){return e.visitTuple(this,this._components,t)}covariant(e){if(Array.isArray(e)&&e.length>=this._fields.length&&this._components.every((t,r)=>{try{return t.covariant(e[r])}catch(e){throw Error(`Invalid ${this.display()} argument: 

index ${r} -> ${e.message}`)}}))return!0;throw Error(`Invalid ${this.display()} argument: ${toReadableString(e)}`)}encodeValue(e){let t=zipWith(this._components,e,(e,t)=>e.encodeValue(t));return(0,P.zo)(...t)}decodeValue(e,t){let r=this.checkType(t);if(!(r instanceof TupleClass))throw Error("not a tuple type");if(r._components.length<this._components.length)throw Error("tuple mismatch");let i=[];for(let[t,n]of r._components.entries())t>=this._components.length?n.decodeValue(e,n):i.push(this._components[t].decodeValue(e,n));return i}display(){let e=this._components.map(e=>e.display());return`record {${e.join("; ")}}`}valueToString(e){let t=zipWith(this._components,e,(e,t)=>e.valueToString(t));return`record {${t.join("; ")}}`}};let VariantClass=class VariantClass extends ConstructType{get typeName(){return l.VariantClass}static[Symbol.hasInstance](e){return e.typeName===l.VariantClass}constructor(e={}){super(),this._fields=Object.entries(e).sort((e,t)=>idlLabelToId(e[0])-idlLabelToId(t[0]))}accept(e,t){return e.visitVariant(this,this._fields,t)}covariant(e){if("object"==typeof e&&1===Object.entries(e).length&&this._fields.every(([t,r])=>{try{return!e.hasOwnProperty(t)||r.covariant(e[t])}catch(e){throw Error(`Invalid ${this.display()} argument: 

variant ${t} -> ${e.message}`)}}))return!0;throw Error(`Invalid ${this.display()} argument: ${toReadableString(e)}`)}encodeValue(e){for(let t=0;t<this._fields.length;t++){let[r,i]=this._fields[t];if(e.hasOwnProperty(r)){let n=(0,A.dZ)(t),a=i.encodeValue(e[r]);return(0,P.zo)(n,a)}}throw Error("Variant has no data: "+e)}_buildTypeTableImpl(e){this._fields.forEach(([,t])=>{t.buildTypeTable(e)});let t=(0,A.nB)(c.Variant),r=(0,A.dZ)(this._fields.length),i=this._fields.map(([t,r])=>(0,P.zo)((0,A.dZ)(idlLabelToId(t)),r.encodeType(e)));e.add(this,(0,P.zo)(t,r,...i))}decodeValue(e,t){let r=this.checkType(t);if(!(r instanceof VariantClass))throw Error("Not a variant type");let i=Number((0,A.aC)(e));if(i>=r._fields.length)throw Error("Invalid variant index: "+i);let[n,a]=r._fields[i];for(let[t,r]of this._fields)if(idlLabelToId(n)===idlLabelToId(t)){let i=r.decodeValue(e,a);return{[t]:i}}throw Error("Cannot find field hash "+n)}get name(){let e=this._fields.map(([e,t])=>e+":"+t.name);return`variant {${e.join("; ")}}`}display(){let e=this._fields.map(([e,t])=>e+("null"===t.name?"":`:${t.display()}`));return`variant {${e.join("; ")}}`}valueToString(e){for(let[t,r]of this._fields)if(e.hasOwnProperty(t)){let i=r.valueToString(e[t]);if("null"===i)return`variant {${t}}`;return`variant {${t}=${i}}`}throw Error("Variant has no data: "+e)}get alternativesAsObject(){let e={};for(let[t,r]of this._fields)e[idlLabelToId(t)]=r;return e}};let RecClass=class RecClass extends ConstructType{constructor(){super(...arguments),this._id=RecClass._counter++}get typeName(){return l.RecClass}static{this._counter=0}static[Symbol.hasInstance](e){return e.typeName===l.RecClass}accept(e,t){if(!this._type)throw Error("Recursive type uninitialized.");return e.visitRec(this,this._type,t)}fill(e){this._type=e}getType(){return this._type}covariant(e){if(this._type&&this._type.covariant(e))return!0;throw Error(`Invalid ${this.display()} argument: ${toReadableString(e)}`)}encodeValue(e){if(!this._type)throw Error("Recursive type uninitialized.");return this._type.encodeValue(e)}_buildTypeTableImpl(e){if(!this._type)throw Error("Recursive type uninitialized.");e.add(this,new Uint8Array([])),this._type.buildTypeTable(e),e.merge(this,this._type.name)}decodeValue(e,t){if(!this._type)throw Error("Recursive type uninitialized.");return this._type.decodeValue(e,t)}get name(){return`rec_${this._id}`}display(){if(!this._type)throw Error("Recursive type uninitialized.");return`μ${this.name}.${this._type.name}`}valueToString(e){if(!this._type)throw Error("Recursive type uninitialized.");return this._type.valueToString(e)}};function decodePrincipalId(e){let t=(0,A.U1)(e);if(1!==t)throw Error("Cannot decode principal");let r=Number((0,A.aC)(e));return O.R.fromUint8Array(new Uint8Array((0,A.DM)(e,r)))}let PrincipalClass=class PrincipalClass extends PrimitiveType{get typeName(){return l.PrincipalClass}static[Symbol.hasInstance](e){return e.typeName===l.PrincipalClass}accept(e,t){return e.visitPrincipal(this,t)}covariant(e){if(e&&e._isPrincipal)return!0;throw Error(`Invalid ${this.display()} argument: ${toReadableString(e)}`)}encodeValue(e){let t=e.toUint8Array(),r=(0,A.dZ)(t.byteLength);return(0,P.zo)(new Uint8Array([1]),r,t)}encodeType(){return(0,A.nB)(c.Principal)}decodeValue(e,t){return this.checkType(t),decodePrincipalId(e)}get name(){return"principal"}valueToString(e){return`${this.name} "${e.toText()}"`}};let FuncClass=class FuncClass extends ConstructType{get typeName(){return l.FuncClass}static[Symbol.hasInstance](e){return e.typeName===l.FuncClass}static argsToString(e,t){if(e.length!==t.length)throw Error("arity mismatch");return"("+e.map((e,r)=>e.valueToString(t[r])).join(", ")+")"}constructor(e,t,r=[]){super(),this.argTypes=e,this.retTypes=t,this.annotations=r}accept(e,t){return e.visitFunc(this,t)}covariant(e){if(Array.isArray(e)&&2===e.length&&e[0]&&e[0]._isPrincipal&&"string"==typeof e[1])return!0;throw Error(`Invalid ${this.display()} argument: ${toReadableString(e)}`)}encodeValue([e,t]){let r=e.toUint8Array(),i=(0,A.dZ)(r.byteLength),n=(0,P.zo)(new Uint8Array([1]),i,r),a=new TextEncoder().encode(t),s=(0,A.dZ)(a.byteLength);return(0,P.zo)(new Uint8Array([1]),n,s,a)}_buildTypeTableImpl(e){this.argTypes.forEach(t=>t.buildTypeTable(e)),this.retTypes.forEach(t=>t.buildTypeTable(e));let t=(0,A.nB)(c.Func),r=(0,A.dZ)(this.argTypes.length),i=(0,P.zo)(...this.argTypes.map(t=>t.encodeType(e))),n=(0,A.dZ)(this.retTypes.length),a=(0,P.zo)(...this.retTypes.map(t=>t.encodeType(e))),s=(0,A.dZ)(this.annotations.length),o=(0,P.zo)(...this.annotations.map(e=>this.encodeAnnotation(e)));e.add(this,(0,P.zo)(t,r,i,n,a,s,o))}decodeValue(e,t){let r=t instanceof RecClass?t.getType()??t:t;if(!subtype(r,this))throw Error(`Cannot decode function reference at type ${this.display()} from wire type ${r.display()}`);let i=(0,A.U1)(e);if(1!==i)throw Error("Cannot decode function reference");let n=decodePrincipalId(e),a=Number((0,A.aC)(e)),s=(0,A.DM)(e,a),o=new TextDecoder("utf8",{fatal:!0}),c=o.decode(s);return[n,c]}get name(){let e=this.argTypes.map(e=>e.name).join(", "),t=this.retTypes.map(e=>e.name).join(", "),r=" "+this.annotations.join(" ");return`(${e}) -> (${t})${r}`}valueToString([e,t]){return`func "${e.toText()}".${t}`}display(){let e=this.argTypes.map(e=>e.display()).join(", "),t=this.retTypes.map(e=>e.display()).join(", "),r=" "+this.annotations.join(" ");return`(${e}) → (${t})${r}`}encodeAnnotation(e){if("query"===e)return new Uint8Array([1]);if("oneway"===e)return new Uint8Array([2]);if("composite_query"===e)return new Uint8Array([3]);throw Error("Illegal function annotation")}};let ServiceClass=class ServiceClass extends ConstructType{get typeName(){return l.ServiceClass}static[Symbol.hasInstance](e){return e.typeName===l.ServiceClass}constructor(e){super(),this._fields=Object.entries(e).sort((e,t)=>e[0]<t[0]?-1:e[0]>t[0]?1:0)}accept(e,t){return e.visitService(this,t)}covariant(e){if(e&&e._isPrincipal)return!0;throw Error(`Invalid ${this.display()} argument: ${toReadableString(e)}`)}encodeValue(e){let t=e.toUint8Array(),r=(0,A.dZ)(t.length);return(0,P.zo)(new Uint8Array([1]),r,t)}_buildTypeTableImpl(e){this._fields.forEach(([t,r])=>r.buildTypeTable(e));let t=(0,A.nB)(c.Service),r=(0,A.dZ)(this._fields.length),i=this._fields.map(([t,r])=>{let i=new TextEncoder().encode(t),n=(0,A.dZ)(i.length);return(0,P.zo)(n,i,r.encodeType(e))});e.add(this,(0,P.zo)(t,r,...i))}decodeValue(e,t){let r=t instanceof RecClass?t.getType()??t:t;if(!subtype(r,this))throw Error(`Cannot decode service reference at type ${this.display()} from wire type ${r.display()}`);return decodePrincipalId(e)}get name(){let e=this._fields.map(([e,t])=>e+":"+t.name);return`service {${e.join("; ")}}`}valueToString(e){return`service "${e.toText()}"`}fieldsAsObject(){let e={};for(let[t,r]of this._fields)e[t]=r;return e}};function toReadableString(e){let t=JSON.stringify(e,(e,t)=>"bigint"==typeof t?`BigInt(${t})`:t);return t&&t.length>400?t.substring(0,397)+"...":t}function encode(e,t){if(t.length<e.length)throw Error("Wrong number of message arguments");let r=new TypeTable;e.forEach(e=>e.buildTypeTable(r));let i=new TextEncoder().encode(D),n=r.encode(),a=(0,A.dZ)(t.length),s=(0,P.zo)(...e.map(e=>e.encodeType(r))),o=(0,P.zo)(...zipWith(e,t,(e,t)=>{try{e.covariant(t)}catch(t){let e=Error(t.message+"\n\n");throw e}return e.encodeValue(t)}));return(0,P.zo)(i,n,a,s,o)}function decode(e,t){let r=new P.P8(t);if(t.byteLength<D.length)throw Error("Message length smaller than magic number");let i=(0,A.DM)(r,D.length),n=new TextDecoder().decode(i);if(n!==D)throw Error("Wrong magic number: "+JSON.stringify(n));function readTypeTable(e){let t=[],r=Number((0,A.aC)(e));for(let i=0;i<r;i++){let r=Number((0,A.WB)(e));switch(r){case c.Opt:case c.Vector:{let i=Number((0,A.WB)(e));t.push([r,i]);break}case c.Record:case c.Variant:{let i;let n=[],a=Number((0,A.aC)(e));for(;a--;){let t=Number((0,A.aC)(e));if(t>=4294967296)throw Error("field id out of 32-bit range");if("number"==typeof i&&i>=t)throw Error("field id collision or not sorted");i=t;let r=Number((0,A.WB)(e));n.push([t,r])}t.push([r,n]);break}case c.Func:{let i=[],n=Number((0,A.aC)(e));for(;n--;)i.push(Number((0,A.WB)(e)));let a=[],s=Number((0,A.aC)(e));for(;s--;)a.push(Number((0,A.WB)(e)));let o=[],c=Number((0,A.aC)(e));for(;c--;){let t=Number((0,A.aC)(e));switch(t){case 1:o.push("query");break;case 2:o.push("oneway");break;case 3:o.push("composite_query");break;default:throw Error("unknown annotation")}}t.push([r,[i,a,o]]);break}case c.Service:{let i=Number((0,A.aC)(e)),n=[];for(;i--;){let t=Number((0,A.aC)(e)),r=new TextDecoder().decode((0,A.DM)(e,t)),i=(0,A.WB)(e);n.push([r,i])}t.push([r,n]);break}default:throw Error("Illegal op_code: "+r)}}let i=[],n=Number((0,A.aC)(e));for(let t=0;t<n;t++)i.push(Number((0,A.WB)(e)));return[t,i]}let[a,s]=readTypeTable(r);if(s.length<e.length)throw Error("Wrong number of return values");let o=a.map(e=>Rec());function getType(e){if(e<-24)throw Error("future value not supported");if(e<0)switch(e){case -1:return Y;case -2:return z;case -3:return er;case -4:return ee;case -5:return el;case -6:return eu;case -7:return ed;case -8:return ef;case -9:return ea;case -10:return es;case -11:return eo;case -12:return ec;case -13:return ei;case -14:return en;case -15:return H;case -16:return K;case -17:return L;case -24:return eh;default:throw Error("Illegal op_code: "+e)}if(e>=a.length)throw Error("type index out of range");return o[e]}function buildType(e){switch(e[0]){case c.Vector:{let t=getType(e[1]);return Vec(t)}case c.Opt:{let t=getType(e[1]);return Opt(t)}case c.Record:{let t={};for(let[r,i]of e[1]){let e=`_${r}_`;t[e]=getType(i)}let r=Record(t),i=r.tryAsTuple();if(Array.isArray(i))return Tuple(...i);return r}case c.Variant:{let t={};for(let[r,i]of e[1]){let e=`_${r}_`;t[e]=getType(i)}return Variant(t)}case c.Func:{let[t,r,i]=e[1];return Func(t.map(e=>getType(e)),r.map(e=>getType(e)),i)}case c.Service:{let t={},r=e[1];for(let[e,i]of r){let r=getType(i);if(r instanceof RecClass&&(r=r.getType()),!(r instanceof FuncClass))throw Error("Illegal service definition: services can only contain functions");t[e]=r}return Service(t)}default:throw Error("Illegal op_code: "+e[0])}}a.forEach((e,t)=>{if(e[0]===c.Func){let r=buildType(e);o[t].fill(r)}}),a.forEach((e,t)=>{if(e[0]!==c.Func){let r=buildType(e);o[t].fill(r)}}),resetSubtypeCache();let l=s.map(e=>getType(e));try{let t=e.map((e,t)=>e.decodeValue(r,l[t]));for(let t=e.length;t<l.length;t++)l[t].decodeValue(r,l[t]);if(r.byteLength>0)throw Error("decode: Left-over bytes");return t}finally{resetSubtypeCache()}}let L=new EmptyClass,K=new ReservedClass,G=new UnknownClass,z=new BoolClass,Y=new NullClass,H=new TextClass,ee=new IntClass,er=new NatClass,ei=new FloatClass(32),en=new FloatClass(64),ea=new FixedIntClass(8),es=new FixedIntClass(16),eo=new FixedIntClass(32),ec=new FixedIntClass(64),el=new FixedNatClass(8),eu=new FixedNatClass(16),ed=new FixedNatClass(32),ef=new FixedNatClass(64),eh=new PrincipalClass;function Tuple(...e){return new TupleClass(e)}function Vec(e){return new VecClass(e)}function Opt(e){return new OptClass(e)}function Record(e){return new RecordClass(e)}function Variant(e){return new VariantClass(e)}function Rec(){return new RecClass}function Func(e,t,r=[]){return new FuncClass(e,t,r)}function Service(e){return new ServiceClass(e)}let Relations=class Relations{constructor(e=new Map){this.rels=e}copy(){let e=new Map;for(let[t,r]of this.rels.entries()){let i=new Map(r);e.set(t,i)}return new Relations(e)}known(e,t){return this.rels.get(e.name)?.get(t.name)}addNegative(e,t){this.addNames(e.name,t.name,!1)}add(e,t){this.addNames(e.name,t.name,!0)}display(){let e="";for(let[t,r]of this.rels)for(let[i,n]of r){let r=n?":<":"!<:";e+=`${t} ${r} ${i}
`}return e}addNames(e,t,r){let i=this.rels.get(e);if(void 0==i){let i=new Map;i.set(t,r),this.rels.set(e,i)}else i.set(t,r)}};let ep=new Relations;function resetSubtypeCache(){ep=new Relations}function eqFunctionAnnotations(e,t){let r=new Set(e.annotations),i=new Set(t.annotations);if(r.size!==i.size)return!1;for(let e of r)if(!i.has(e))return!1;return!0}function canBeOmmitted(e){return e instanceof OptClass||e instanceof NullClass||e instanceof ReservedClass}function subtype(e,t){let r=ep.copy(),i=subtype_(r,e,t);return i?ep.add(e,t):ep.addNegative(e,t),i}function subtype_(e,t,r){if(t.name===r.name)return!0;let i=e.known(t,r);if(void 0!==i)return i;if(e.add(t,r),r instanceof ReservedClass||t instanceof EmptyClass||t instanceof NatClass&&r instanceof IntClass)return!0;if(t instanceof VecClass&&r instanceof VecClass)return subtype_(e,t._type,r._type);if(r instanceof OptClass)return!0;if(t instanceof RecordClass&&r instanceof RecordClass){let i=t.fieldsAsObject;for(let[t,n]of r._fields){let r=i[idlLabelToId(t)];if(r){if(!subtype_(e,r,n))return!1}else if(!canBeOmmitted(n))return!1}return!0}if(t instanceof FuncClass&&r instanceof FuncClass){if(!eqFunctionAnnotations(t,r))return!1;for(let i=0;i<t.argTypes.length;i++){let n=t.argTypes[i];if(i<r.argTypes.length){if(!subtype_(e,r.argTypes[i],n))return!1}else if(!canBeOmmitted(n))return!1}for(let i=0;i<r.retTypes.length;i++){let n=r.retTypes[i];if(i<t.retTypes.length){if(!subtype_(e,t.retTypes[i],n))return!1}else if(!canBeOmmitted(n))return!1}return!0}if(t instanceof VariantClass&&r instanceof VariantClass){let i=r.alternativesAsObject;for(let[r,n]of t._fields){let t=i[idlLabelToId(r)];if(!t||!subtype_(e,n,t))return!1}return!0}if(t instanceof ServiceClass&&r instanceof ServiceClass){let i=t.fieldsAsObject();for(let[t,n]of r._fields){let r=i[t];if(!r||!subtype_(e,r,n))return!1}return!0}return t instanceof RecClass?subtype_(e,t.getType(),r):r instanceof RecClass&&subtype_(e,t,r.getType())}let w=class w extends Error{constructor(e){super(e),this.name="DecodingError"}};let ey=Symbol("CBOR_STOP_CODE");var em=((i=em||{})[i.False=20]="False",i[i.True=21]="True",i[i.Null=22]="Null",i[i.Undefined=23]="Undefined",i[i.Break=31]="Break",i),eb=((n=eb||{})[n.UnsignedInteger=0]="UnsignedInteger",n[n.NegativeInteger=1]="NegativeInteger",n[n.ByteString=2]="ByteString",n[n.TextString=3]="TextString",n[n.Array=4]="Array",n[n.Map=5]="Map",n[n.Tag=6]="Tag",n[n.Simple=7]="Simple",n);let eg=BigInt("0xffffffffffffffff");var ew=((a=ew||{})[a.Value=23]="Value",a[a.OneByte=24]="OneByte",a[a.TwoBytes=25]="TwoBytes",a[a.FourBytes=26]="FourBytes",a[a.EightBytes=27]="EightBytes",a[a.Indefinite=31]="Indefinite",a);function W(e){return null==e}function R(e,t){let r=new Uint8Array(t);return r.set(e),r}let e_=new TextDecoder;function Z(e){return(224&e)>>5}function q(e){return 31&e}let ev=new Uint8Array,eE,eT=0;function ut(e,t){ev=e,eT=0;let r=B(t);return(null==t?void 0:t(r))??r}function B(e){let[t,r]=N();switch(t){case eb.UnsignedInteger:return E(r);case eb.NegativeInteger:return j(r);case eb.ByteString:return $(r);case eb.TextString:return F(r);case eb.Array:return J(r,e);case eb.Map:return b(r,e);case eb.Tag:return M(r,e);case eb.Simple:return Q(r)}throw new w(`Unsupported major type: ${t}`)}function N(){let e=ev.at(eT);if(W(e))throw new w("Provided CBOR data is empty");let t=Z(e),r=q(e);return eT++,[t,r]}function J(e,t){let r=E(e);if(r===1/0){let e=[],r=B(t);for(;r!==ey;)e.push((null==t?void 0:t(r))??r),r=B(t);return e}let i=Array(r);for(let e=0;e<r;e++){let r=B(t);i[e]=(null==t?void 0:t(r))??r}return i}function Q(e){switch(e){case em.False:return!1;case em.True:return!0;case em.Null:return null;case em.Undefined:return;case em.Break:return ey}throw new w(`Unrecognized simple type: ${e.toString(2)}`)}function b(e,t){let r=E(e),i={};if(r===1/0){let[e,r]=N();for(;e!==eb.Simple&&r!==em.Break;){let n=F(r),a=B(t);i[n]=(null==t?void 0:t(a,n))??a,[e,r]=N()}return i}for(let e=0;e<r;e++){let[e,r]=N();if(e!==eb.TextString)throw new w("Map keys must be text strings");let n=F(r),a=B(t);i[n]=(null==t?void 0:t(a,n))??a}return i}function E(e){if(e<=ew.Value)return e;switch(eE=new DataView(ev.buffer,ev.byteOffset+eT),e){case ew.OneByte:return eT++,eE.getUint8(0);case ew.TwoBytes:return eT+=2,eE.getUint16(0,!1);case ew.FourBytes:return eT+=4,eE.getUint32(0,!1);case ew.EightBytes:return eT+=8,eE.getBigUint64(0,!1);case ew.Indefinite:return 1/0;default:throw new w(`Unsupported integer info: ${e.toString(2)}`)}}function j(e){let t=E(e);return"number"==typeof t?-1-t:-1n-t}function $(e){let t=E(e);if(t>Number.MAX_SAFE_INTEGER)throw new w("Byte length is too large");let r=Number(t);return eT+=r,ev.slice(eT-r,eT)}function F(e){let t=$(e);return e_.decode(t)}function M(e,t){let r=E(e);if(55799===r)return B(t);throw new w(`Unsupported tag: ${r}.`)}let x=class x extends Error{constructor(e){super(e),this.name="SerializationError"}};let eC=new TextEncoder,ex=new Uint8Array(2048),eI=new DataView(ex.buffer),eB=0,eS=[];function dt(e,t){eB=0;let r=(null==t?void 0:t(e))??e;return it(55799,r,t),ex.slice(0,eB)}function _(e,t){if(eB>ex.length-100&&(ex=R(ex,2*ex.length),eI=new DataView(ex.buffer)),!1===e||!0===e||null==e){et(e);return}if("number"==typeof e||"bigint"==typeof e){ft(e);return}if("string"==typeof e){X(e);return}if(e instanceof Uint8Array){V(e);return}if(e instanceof ArrayBuffer){V(new Uint8Array(e));return}if(Array.isArray(e)){tt(e,t);return}if("object"==typeof e){nt(e,t);return}throw new x(`Unsupported type: ${typeof e}`)}function tt(e,t){I(eb.Array,e.length),e.forEach((e,r)=>{_((null==t?void 0:t(e,r.toString()))??e,t)})}function nt(e,t){eS=Object.entries(e),I(eb.Map,eS.length),eS.forEach(([e,r])=>{X(e),_((null==t?void 0:t(r,e))??r,t)})}function I(e,t){if(t<=23){eI.setUint8(eB++,e<<5|Number(t));return}if(t<=255){eI.setUint8(eB++,e<<5|ew.OneByte),eI.setUint8(eB,Number(t)),eB+=1;return}if(t<=65535){eI.setUint8(eB++,e<<5|ew.TwoBytes),eI.setUint16(eB,Number(t),!1),eB+=2;return}if(t<=4294967295){eI.setUint8(eB++,e<<5|ew.FourBytes),eI.setUint32(eB,Number(t),!1),eB+=4;return}if(t<=eg){eI.setUint8(eB++,e<<5|ew.EightBytes),eI.setBigUint64(eB,BigInt(t),!1),eB+=8;return}throw new x(`Value too large to encode: ${t}`)}function et(e){I(eb.Simple,st(e))}function st(e){if(!1===e)return em.False;if(!0===e)return em.True;if(null===e)return em.Null;if(void 0===e)return em.Undefined;throw new x(`Unrecognized simple value: ${e.toString()}`)}function k(e,t){I(e,t.length),eB>ex.length-t.length&&(ex=R(ex,ex.length+t.length),eI=new DataView(ex.buffer)),ex.set(t,eB),eB+=t.length}function ct(e){I(eb.UnsignedInteger,e)}function ot(e){I(eb.NegativeInteger,"bigint"==typeof e?-1n-e:-1-e)}function ft(e){e>=0?ct(e):ot(e)}function X(e){k(eb.TextString,eC.encode(e))}function V(e){k(eb.ByteString,e)}function it(e,t,r){I(eb.Tag,e),_(t,r)}let randomNumber=()=>{if("undefined"!=typeof window&&window.crypto&&window.crypto.getRandomValues){let e=new Uint32Array(1);return window.crypto.getRandomValues(e),e[0]}if("undefined"!=typeof crypto&&crypto.getRandomValues){let e=new Uint32Array(1);return crypto.getRandomValues(e),e[0]}return"undefined"!=typeof crypto&&crypto.randomInt?crypto.randomInt(0,4294967295):Math.floor(4294967295*Math.random())};function makeNonce(){let e=new ArrayBuffer(16),t=new DataView(e),r=randomNumber(),i=randomNumber(),n=randomNumber(),a=randomNumber();return t.setUint32(0,r),t.setUint32(4,i),t.setUint32(8,n),t.setUint32(12,a),Object.assign(new Uint8Array(e),{__nonce__:void 0})}(function(e){e.Query="read",e.ReadState="read_state",e.Call="call"})(u||(u={})),(d||(d={})).Call="call",function(e){e.Query="query",e.ReadState="read_state"}(f||(f={}));let eR="__expiry__",eN=BigInt(1e3),eO=BigInt(1e6),eF=BigInt(60),eV=eF*eN,eP=BigInt(1)*eV;function roundToSecond(e){return e/eN*eN}function roundToMinute(e){return e/eV*eV}let Expiry=class Expiry{constructor(e){this.__expiry__=e,this._isExpiry=!0}static fromDeltaInMilliseconds(e,t=0){let r;let i=BigInt(Date.now())+BigInt(t),n=i+BigInt(e),a=roundToMinute(n);if(a>=i+eP)r=a;else{let e=roundToSecond(n);r=e}return new Expiry(r*eO)}toBigInt(){return this.__expiry__}toHash(){return(0,A.dZ)(this.__expiry__)}toString(){return this.__expiry__.toString()}toJSON(){return{[eR]:this.toString()}}static fromJSON(e){let t=JSON.parse(e);if(t[eR])try{let e=BigInt(t[eR]);return new Expiry(e)}catch(e){throw new S.pd(new S.Ds(`Not a valid BigInt: ${e}`))}throw new S.pd(new S.Ds(`The input does not contain the key ${eR}`))}static isExpiry(e){return e instanceof Expiry||"object"==typeof e&&null!==e&&"_isExpiry"in e&&!0===e._isExpiry&&"__expiry__"in e&&"bigint"==typeof e.__expiry__}};function makeNonceTransform(e=makeNonce){return async t=>{let r=t.request.headers;t.request.headers=r,t.endpoint===u.Call&&(t.body.nonce=e())}}function httpHeadersTransform(e){let t=[];return e.forEach((e,r)=>{t.push([r,e])}),t}function hasCborValueMethod(e){return"object"==typeof e&&null!==e&&"toCborValue"in e}function cbor_encode(e){try{return dt(e,e=>O.R.isPrincipal(e)?e.toUint8Array():Expiry.isExpiry(e)?e.toBigInt():hasCborValueMethod(e)?e.toCborValue():e)}catch(t){throw S.pd.fromCode(new S.zH(t,e))}}function cbor_decode(e){try{return ut(e)}catch(t){throw S.pd.fromCode(new S.GU(t,e))}}var eA=r(2873),ek=r(6985),eq=r(2875),eU=r(1508),eD=r(8464),e$=r(7427);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */let divNearest=(e,t)=>(e+(e>=0?t:-t)/eM)/t;function _splitEndoScalar(e,t,r){let[[i,n],[a,s]]=t,o=divNearest(s*e,r),c=divNearest(-n*e,r),l=e-o*i-c*a,u=-o*n-c*s,d=l<eL,f=u<eL;d&&(l=-l),f&&(u=-u);let h=(0,ek.dQ)(Math.ceil((0,ek.Dd)(r)/2))+eK;if(l<eL||l>=h||u<eL||u>=h)throw Error("splitScalar (endomorphism): failed, k="+e);return{k1neg:d,k1:l,k2neg:f,k2:u}}function validateSigFormat(e){if(!["compact","recovered","der"].includes(e))throw Error('Signature format must be "compact", "recovered", or "der"');return e}let DERErr=class DERErr extends Error{constructor(e=""){super(e)}};let eL=BigInt(0),eK=BigInt(1),eM=BigInt(2),ej=BigInt(3),eG=BigInt(4);function _normFnElement(e,t){let r;let{BYTES:i}=e;if("bigint"==typeof t)r=t;else{let n=(0,ek.ql)("private key",t);try{r=e.fromBytes(n)}catch(e){throw Error(`invalid private key: expected ui8a of size ${i}, got ${typeof t}`)}}if(!e.isValidNot0(r))throw Error("invalid private key: out of range [1..N-1]");return r}function weierstrassN(e,t={}){let r=(0,eU.rO)("weierstrass",e,t),{Fp:i,Fn:n}=r,a=r.CURVE,{h:s,n:o}=a;(0,ek.fA)(t,{},{allowInfinityPoint:"boolean",clearCofactor:"function",isTorsionFree:"function",fromBytes:"function",toBytes:"function",endo:"object",wrapPrivateKey:"boolean"});let{endo:c}=t;if(c&&(!i.is0(a.a)||"bigint"!=typeof c.beta||!Array.isArray(c.basises)))throw Error('invalid endo: expected "beta": bigint and "basises": array');let l=getWLengths(i,n);function assertCompressionIsSupported(){if(!i.isOdd)throw Error("compression is not supported: Field does not have .isOdd()")}function pointToBytes(e,t,r){let{x:n,y:a}=t.toAffine(),s=i.toBytes(n);if((0,ek.po)(r,"isCompressed"),!r)return(0,eq.eV)(Uint8Array.of(4),s,i.toBytes(a));{assertCompressionIsSupported();let e=!i.isOdd(a);return(0,eq.eV)(pprefix(e),s)}}function pointFromBytes(e){(0,ek.GB)(e,void 0,"Point");let{publicKey:t,publicKeyUncompressed:r}=l,n=e.length,a=e[0],s=e.subarray(1);if(n===t&&(2===a||3===a)){let e;let t=i.fromBytes(s);if(!i.isValid(t))throw Error("bad point: is not on curve, wrong x");let r=weierstrassEquation(t);try{e=i.sqrt(r)}catch(t){let e=t instanceof Error?": "+t.message:"";throw Error("bad point: is not on curve, sqrt error"+e)}assertCompressionIsSupported();let n=i.isOdd(e);return(1&a)==1!==n&&(e=i.neg(e)),{x:t,y:e}}if(n===r&&4===a){let e=i.BYTES,t=i.fromBytes(s.subarray(0,e)),r=i.fromBytes(s.subarray(e,2*e));if(!isValidXY(t,r))throw Error("bad point: is not on curve");return{x:t,y:r}}throw Error(`bad point: got length ${n}, expected compressed=${t} or uncompressed=${r}`)}let u=t.toBytes||pointToBytes,d=t.fromBytes||pointFromBytes;function weierstrassEquation(e){let t=i.sqr(e),r=i.mul(t,e);return i.add(i.add(r,i.mul(e,a.a)),a.b)}function isValidXY(e,t){let r=i.sqr(t),n=weierstrassEquation(e);return i.eql(r,n)}if(!isValidXY(a.Gx,a.Gy))throw Error("bad curve params: generator point");let f=i.mul(i.pow(a.a,ej),eG),h=i.mul(i.sqr(a.b),BigInt(27));if(i.is0(i.add(f,h)))throw Error("bad curve params: a or b");function acoord(e,t,r=!1){if(!i.isValid(t)||r&&i.is0(t))throw Error(`bad point coordinate ${e}`);return t}function aprjpoint(e){if(!(e instanceof Point))throw Error("ProjectivePoint expected")}function splitEndoScalarN(e){if(!c||!c.basises)throw Error("no endo");return _splitEndoScalar(e,c.basises,n.ORDER)}let p=(0,ek.H9)((e,t)=>{let{X:r,Y:n,Z:a}=e;if(i.eql(a,i.ONE))return{x:r,y:n};let s=e.is0();null==t&&(t=s?i.ONE:i.inv(a));let o=i.mul(r,t),c=i.mul(n,t),l=i.mul(a,t);if(s)return{x:i.ZERO,y:i.ZERO};if(!i.eql(l,i.ONE))throw Error("invZ was invalid");return{x:o,y:c}}),y=(0,ek.H9)(e=>{if(e.is0()){if(t.allowInfinityPoint&&!i.is0(e.Y))return;throw Error("bad point: ZERO")}let{x:r,y:n}=e.toAffine();if(!i.isValid(r)||!i.isValid(n))throw Error("bad point: x or y not field elements");if(!isValidXY(r,n))throw Error("bad point: equation left != right");if(!e.isTorsionFree())throw Error("bad point: not in prime-order subgroup");return!0});function finishEndo(e,t,r,n,a){return r=new Point(i.mul(r.X,e),r.Y,r.Z),t=(0,eU.xg)(n,t),r=(0,eU.xg)(a,r),t.add(r)}let Point=class Point{constructor(e,t,r){this.X=acoord("x",e),this.Y=acoord("y",t,!0),this.Z=acoord("z",r),Object.freeze(this)}static CURVE(){return a}static fromAffine(e){let{x:t,y:r}=e||{};if(!e||!i.isValid(t)||!i.isValid(r))throw Error("invalid affine point");if(e instanceof Point)throw Error("projective point not allowed");return i.is0(t)&&i.is0(r)?Point.ZERO:new Point(t,r,i.ONE)}static fromBytes(e){let t=Point.fromAffine(d((0,ek.GB)(e,void 0,"point")));return t.assertValidity(),t}static fromHex(e){return Point.fromBytes((0,ek.ql)("pointHex",e))}get x(){return this.toAffine().x}get y(){return this.toAffine().y}precompute(e=8,t=!0){return g.createCache(this,e),t||this.multiply(ej),this}assertValidity(){y(this)}hasEvenY(){let{y:e}=this.toAffine();if(!i.isOdd)throw Error("Field doesn't support isOdd");return!i.isOdd(e)}equals(e){aprjpoint(e);let{X:t,Y:r,Z:n}=this,{X:a,Y:s,Z:o}=e,c=i.eql(i.mul(t,o),i.mul(a,n)),l=i.eql(i.mul(r,o),i.mul(s,n));return c&&l}negate(){return new Point(this.X,i.neg(this.Y),this.Z)}double(){let{a:e,b:t}=a,r=i.mul(t,ej),{X:n,Y:s,Z:o}=this,c=i.ZERO,l=i.ZERO,u=i.ZERO,d=i.mul(n,n),f=i.mul(s,s),h=i.mul(o,o),p=i.mul(n,s);return p=i.add(p,p),u=i.mul(n,o),u=i.add(u,u),c=i.mul(e,u),l=i.mul(r,h),l=i.add(c,l),c=i.sub(f,l),l=i.add(f,l),l=i.mul(c,l),c=i.mul(p,c),u=i.mul(r,u),h=i.mul(e,h),p=i.sub(d,h),p=i.mul(e,p),p=i.add(p,u),u=i.add(d,d),d=i.add(u,d),d=i.add(d,h),d=i.mul(d,p),l=i.add(l,d),h=i.mul(s,o),h=i.add(h,h),d=i.mul(h,p),c=i.sub(c,d),u=i.mul(h,f),u=i.add(u,u),new Point(c,l,u=i.add(u,u))}add(e){aprjpoint(e);let{X:t,Y:r,Z:n}=this,{X:s,Y:o,Z:c}=e,l=i.ZERO,u=i.ZERO,d=i.ZERO,f=a.a,h=i.mul(a.b,ej),p=i.mul(t,s),y=i.mul(r,o),m=i.mul(n,c),g=i.add(t,r),v=i.add(s,o);g=i.mul(g,v),v=i.add(p,y),g=i.sub(g,v),v=i.add(t,n);let T=i.add(s,c);return v=i.mul(v,T),T=i.add(p,m),v=i.sub(v,T),T=i.add(r,n),l=i.add(o,c),T=i.mul(T,l),l=i.add(y,m),T=i.sub(T,l),d=i.mul(f,v),l=i.mul(h,m),d=i.add(l,d),l=i.sub(y,d),d=i.add(y,d),u=i.mul(l,d),y=i.add(p,p),y=i.add(y,p),m=i.mul(f,m),v=i.mul(h,v),y=i.add(y,m),m=i.sub(p,m),m=i.mul(f,m),v=i.add(v,m),p=i.mul(y,v),u=i.add(u,p),p=i.mul(T,v),l=i.mul(g,l),l=i.sub(l,p),p=i.mul(g,y),d=i.mul(T,d),new Point(l,u,d=i.add(d,p))}subtract(e){return this.add(e.negate())}is0(){return this.equals(Point.ZERO)}multiply(e){let r,i;let{endo:a}=t;if(!n.isValidNot0(e))throw Error("invalid scalar: out of range");let mul=e=>g.cached(this,e,e=>(0,eU.A1)(Point,e));if(a){let{k1neg:t,k1:n,k2neg:s,k2:o}=splitEndoScalarN(e),{p:c,f:l}=mul(n),{p:u,f:d}=mul(o);i=l.add(d),r=finishEndo(a.beta,c,u,t,s)}else{let{p:t,f:n}=mul(e);r=t,i=n}return(0,eU.A1)(Point,[r,i])[0]}multiplyUnsafe(e){let{endo:r}=t;if(!n.isValid(e))throw Error("invalid scalar: out of range");if(e===eL||this.is0())return Point.ZERO;if(e===eK)return this;if(g.hasCache(this))return this.multiply(e);if(!r)return g.unsafe(this,e);{let{k1neg:t,k1:i,k2neg:n,k2:a}=splitEndoScalarN(e),{p1:s,p2:o}=(0,eU.N6)(Point,this,i,a);return finishEndo(r.beta,s,o,t,n)}}multiplyAndAddUnsafe(e,t,r){let i=this.multiplyUnsafe(t).add(e.multiplyUnsafe(r));return i.is0()?void 0:i}toAffine(e){return p(this,e)}isTorsionFree(){let{isTorsionFree:e}=t;return s===eK||(e?e(Point,this):g.unsafe(this,o).is0())}clearCofactor(){let{clearCofactor:e}=t;return s===eK?this:e?e(Point,this):this.multiplyUnsafe(s)}isSmallOrder(){return this.multiplyUnsafe(s).is0()}toBytes(e=!0){return(0,ek.po)(e,"isCompressed"),this.assertValidity(),u(Point,this,e)}toHex(e=!0){return(0,eq.ci)(this.toBytes(e))}toString(){return`<Point ${this.is0()?"ZERO":this.toHex()}>`}get px(){return this.X}get py(){return this.X}get pz(){return this.Z}toRawBytes(e=!0){return this.toBytes(e)}_setWindowSize(e){this.precompute(e)}static normalizeZ(e){return(0,eU.A1)(Point,e)}static msm(e,t){return(0,eU.D1)(Point,n,e,t)}static fromPrivateKey(e){return Point.BASE.multiply(_normFnElement(n,e))}};Point.BASE=new Point(a.Gx,a.Gy,i.ONE),Point.ZERO=new Point(i.ZERO,i.ONE,i.ZERO),Point.Fp=i,Point.Fn=n;let m=n.BITS,g=new eU.Mx(Point,t.endo?Math.ceil(m/2):m);return Point.BASE.precompute(8),Point}function pprefix(e){return Uint8Array.of(e?2:3)}function SWUFpSqrtRatio(e,t){let r=e.ORDER,i=eL;for(let e=r-eK;e%eM===eL;e/=eM)i+=eK;let n=i,a=eM<<n-eK-eK,s=a*eM,o=(r-eK)/s,c=(o-eK)/eM,l=s-eK,u=e.pow(t,o),d=e.pow(t,(o+eK)/eM),sqrtRatio=(t,r)=>{let i=u,s=e.pow(r,l),o=e.sqr(s);o=e.mul(o,r);let f=e.mul(t,o);f=e.pow(f,c),f=e.mul(f,s),s=e.mul(f,r),o=e.mul(f,t);let h=e.mul(o,s);f=e.pow(h,a);let p=e.eql(f,e.ONE);s=e.mul(o,d),f=e.mul(h,i),o=e.cmov(s,o,p),h=e.cmov(f,h,p);for(let t=n;t>eK;t--){let r=t-eM;r=eM<<r-eK;let n=e.pow(h,r),a=e.eql(n,e.ONE);s=e.mul(o,i),i=e.mul(i,i),n=e.mul(h,i),o=e.cmov(s,o,a),h=e.cmov(n,h,a)}return{isValid:p,value:o}};if(e.ORDER%eG===ej){let r=(e.ORDER-ej)/eG,i=e.sqrt(e.neg(t));sqrtRatio=(t,n)=>{let a=e.sqr(n),s=e.mul(t,n);a=e.mul(a,s);let o=e.pow(a,r);o=e.mul(o,s);let c=e.mul(o,i),l=e.mul(e.sqr(o),n),u=e.eql(l,t),d=e.cmov(c,o,u);return{isValid:u,value:d}}}return sqrtRatio}function mapToCurveSimpleSWU(e,t){(0,e$.OP)(e);let{A:r,B:i,Z:n}=t;if(!e.isValid(r)||!e.isValid(i)||!e.isValid(n))throw Error("mapToCurveSimpleSWU: invalid opts");let a=SWUFpSqrtRatio(e,n);if(!e.isOdd)throw Error("Field does not have .isOdd()");return t=>{let s,o,c,l,u,d,f,h;s=e.sqr(t),s=e.mul(s,n),o=e.sqr(s),o=e.add(o,s),c=e.add(o,e.ONE),c=e.mul(c,i),l=e.cmov(n,e.neg(o),!e.eql(o,e.ZERO)),l=e.mul(l,r),o=e.sqr(c),d=e.sqr(l),u=e.mul(d,r),o=e.add(o,u),o=e.mul(o,c),d=e.mul(d,l),u=e.mul(d,i),o=e.add(o,u),f=e.mul(s,c);let{isValid:p,value:y}=a(o,d);h=e.mul(s,t),h=e.mul(h,y),f=e.cmov(f,c,p),h=e.cmov(h,y,p);let m=e.isOdd(t)===e.isOdd(h);h=e.cmov(e.neg(h),h,m);let g=(0,e$.Eg)(e,[l],!0)[0];return{x:f=e.mul(f,g),y:h}}}function getWLengths(e,t){return{secretKey:t.BYTES,publicKey:1+e.BYTES,publicKeyUncompressed:1+2*e.BYTES,publicKeyHasPrefix:!0,signature:2*t.BYTES}}function weierstrassPoints(e){let{CURVE:t,curveOpts:r}=_weierstrass_legacy_opts_to_new(e),i=weierstrassN(t,r);return _weierstrass_new_output_to_legacy(e,i)}function _weierstrass_legacy_opts_to_new(e){let t={a:e.a,b:e.b,p:e.Fp.ORDER,n:e.n,h:e.h,Gx:e.Gx,Gy:e.Gy},r=e.Fp,i=e.allowedPrivateKeyLengths?Array.from(new Set(e.allowedPrivateKeyLengths.map(e=>Math.ceil(e/2)))):void 0,n=(0,e$.gN)(t.n,{BITS:e.nBitLength,allowedLengths:i,modFromBytes:e.wrapPrivateKey}),a={Fp:r,Fn:n,allowInfinityPoint:e.allowInfinityPoint,endo:e.endo,isTorsionFree:e.isTorsionFree,clearCofactor:e.clearCofactor,fromBytes:e.fromBytes,toBytes:e.toBytes};return{CURVE:t,curveOpts:a}}function _legacyHelperEquat(e,t,r){return function(i){let n=e.sqr(i),a=e.mul(n,i);return e.add(e.add(a,e.mul(i,t)),r)}}function _weierstrass_new_output_to_legacy(e,t){let{Fp:r,Fn:i}=t;function isWithinCurveOrder(e){return(0,ek.Z2)(e,eK,i.ORDER)}let n=_legacyHelperEquat(r,e.a,e.b);return Object.assign({},{CURVE:e,Point:t,ProjectivePoint:t,normPrivateKeyToScalar:e=>_normFnElement(i,e),weierstrassEquation:n,isWithinCurveOrder})}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */let eZ=BigInt(0),ez=BigInt(1),eY=BigInt(2),eH=BigInt(3);function NAfDecomposition(e){let t=[];for(;e>ez;e>>=ez)(e&ez)===eZ?t.unshift(0):(e&eH)===eH?(t.unshift(-1),e+=ez):t.unshift(1);return t}function aNonEmpty(e){if(!Array.isArray(e)||0===e.length)throw Error("expected non-empty array")}function createBlsPairing(e,t,r,i){let n;let{Fp2:a,Fp12:s}=e,{twistType:o,ateLoopSize:c,xNegative:l,postPrecompute:u}=i;if("multiplicative"===o)n=(e,t,r,i,n,o)=>s.mul014(i,e,a.mul(t,n),a.mul(r,o));else if("divisive"===o)n=(e,t,r,i,n,o)=>s.mul034(i,a.mul(r,o),a.mul(t,n),e);else throw Error("bls: unknown twist type");let d=a.div(a.ONE,a.mul(a.ONE,eY));function pointDouble(e,t,r,i){let n=a.sqr(r),s=a.sqr(i),o=a.mulByB(a.mul(s,eH)),c=a.mul(o,eH),l=a.sub(a.sub(a.sqr(a.add(r,i)),s),n),u=a.sub(o,n),f=a.mul(a.sqr(t),eH),h=a.neg(l);return e.push([u,f,h]),{Rx:t=a.mul(a.mul(a.mul(a.sub(n,c),t),r),d),Ry:r=a.sub(a.sqr(a.mul(a.add(n,c),d)),a.mul(a.sqr(o),eH)),Rz:i=a.mul(n,l)}}function pointAdd(e,t,r,i,n,s){let o=a.sub(r,a.mul(s,i)),c=a.sub(t,a.mul(n,i)),l=a.sub(a.mul(o,n),a.mul(c,s)),u=a.neg(o);e.push([l,u,c]);let d=a.sqr(c),f=a.mul(d,c),h=a.mul(d,t),p=a.add(a.sub(f,a.mul(h,eY)),a.mul(a.sqr(o),i));return{Rx:t=a.mul(c,p),Ry:r=a.sub(a.mul(a.sub(h,p),o),a.mul(f,r)),Rz:i=a.mul(i,f)}}let f=NAfDecomposition(c),h=(0,ek.H9)(e=>{let{x:t,y:r}=e.toAffine(),i=a.neg(r),n=t,s=r,o=a.ONE,c=[];for(let e of f){let a=[];({Rx:n,Ry:s,Rz:o}=pointDouble(a,n,s,o)),e&&({Rx:n,Ry:s,Rz:o}=pointAdd(a,n,s,o,t,-1===e?i:r)),c.push(a)}if(u){let e=c[c.length-1];u(n,s,o,t,r,pointAdd.bind(null,e))}return c});function millerLoopBatch(e,t=!1){let r=s.ONE;if(e.length){let t=e[0][0].length;for(let i=0;i<t;i++)for(let[t,a,o]of(r=s.sqr(r),e))for(let[e,s,c]of t[i])r=n(e,s,c,r,a,o)}return l&&(r=s.conjugate(r)),t?s.finalExponentiate(r):r}function pairingBatch(e,i=!0){let n=[];for(let{g1:i,g2:a}of((0,eU.A1)(t,e.map(({g1:e})=>e)),(0,eU.A1)(r,e.map(({g2:e})=>e)),e)){if(i.is0()||a.is0())throw Error("pairing is not available for ZERO point");i.assertValidity(),a.assertValidity();let e=i.toAffine();n.push([h(a),e.x,e.y])}return millerLoopBatch(n,i)}return{Fp12:s,millerLoopBatch,pairing:function(e,t,r=!0){return pairingBatch([{g1:e,g2:t}],r)},pairingBatch,calcPairingPrecomputes:h}}function createBlsSig(e,t,r,i,n){let{Fp12:a,pairingBatch:s}=e;function normPub(e){return e instanceof t.Point?e:t.Point.fromHex(e)}function normSig(e){return e instanceof r.Point?e:r.Point.fromHex(e)}function amsg(e){if(!(e instanceof r.Point))throw Error(`expected valid message hashed to ${n?"G1":"G2"} curve`);return e}let o=n?(e,t)=>({g1:t,g2:e}):(e,t)=>({g1:e,g2:t});return{getPublicKey(e){let r=_normFnElement(t.Point.Fn,e);return t.Point.BASE.multiply(r)},sign(e,r,i){if(null!=i)throw Error("sign() expects 2 arguments");let n=_normFnElement(t.Point.Fn,r);return amsg(e).assertValidity(),e.multiply(n)},verify(e,r,i,n){if(null!=n)throw Error("verify() expects 3 arguments");e=normSig(e),i=normPub(i);let c=i.negate(),l=t.Point.BASE,u=amsg(r),d=e,f=s([o(c,u),o(l,d)]);return a.eql(f,a.ONE)},verifyBatch(e,r,i){if(aNonEmpty(r),i.length!==r.length)throw Error("amount of public keys and messages should be equal");let n=normSig(e),c=i.map(normPub),l=new Map;for(let e=0;e<c.length;e++){let t=c[e],i=r[e],n=l.get(i);void 0===n&&(n=[],l.set(i,n)),n.push(t)}let u=[],d=t.Point.BASE;try{for(let[e,t]of l){let r=t.reduce((e,t)=>e.add(t));u.push(o(r,e))}return u.push(o(d.negate(),n)),a.eql(s(u),a.ONE)}catch{return!1}},aggregatePublicKeys(e){aNonEmpty(e),e=e.map(e=>normPub(e));let r=e.reduce((e,t)=>e.add(t),t.Point.ZERO);return r.assertValidity(),r},aggregateSignatures(e){aNonEmpty(e),e=e.map(e=>normSig(e));let t=e.reduce((e,t)=>e.add(t),r.Point.ZERO);return t.assertValidity(),t},hash(e,t){(0,eq.gk)(e);let i=t?{DST:t}:void 0;return r.hashToCurve(e,i)},Signature:i}}function bls(e){let{Fp:t,Fr:r,Fp2:i,Fp6:n,Fp12:a}=e.fields,s=weierstrassPoints(e.G1),o=Object.assign(s,(0,eD.V1)(s.Point,e.G1.mapToCurve,{...e.htfDefaults,...e.G1.htfDefaults})),c=weierstrassPoints(e.G2),l=Object.assign(c,(0,eD.V1)(c.Point,e.G2.mapToCurve,{...e.htfDefaults,...e.G2.htfDefaults})),u=createBlsPairing(e.fields,o.Point,l.Point,{...e.params,postPrecompute:e.postPrecompute}),{millerLoopBatch:d,pairing:f,pairingBatch:h,calcPairingPrecomputes:p}=u,y=createBlsSig(u,o,l,e.G2.Signature,!1),m=createBlsSig(u,l,o,e.G1.ShortSignature,!0),g=e.randomBytes||eq.O6,randomSecretKey=()=>{let e=(0,e$.PS)(r.ORDER);return(0,e$.Us)(g(e),r.ORDER)},{ShortSignature:v}=e.G1,{Signature:T}=e.G2;function normP1Hash(e,t){return e instanceof o.Point?e:m.hash((0,ek.ql)("point",e),t?.DST)}function normP2Hash(e,t){return e instanceof l.Point?e:y.hash((0,ek.ql)("point",e),t?.DST)}function getPublicKey(e){return y.getPublicKey(e).toBytes(!0)}function getPublicKeyForShortSignatures(e){return m.getPublicKey(e).toBytes(!0)}function sign(e,t,r){let i=normP2Hash(e,r),n=y.sign(i,t);return e instanceof l.Point?n:T.toBytes(n)}function signShortSignature(e,t,r){let i=normP1Hash(e,r),n=m.sign(i,t);return e instanceof o.Point?n:v.toBytes(n)}function verify(e,t,r,i){let n=normP2Hash(t,i);return y.verify(e,n,r)}function verifyShortSignature(e,t,r,i){let n=normP1Hash(t,i);return m.verify(e,n,r)}function aggregatePublicKeys(e){let t=y.aggregatePublicKeys(e);return e[0]instanceof o.Point?t:t.toBytes(!0)}function aggregateSignatures(e){let t=y.aggregateSignatures(e);return e[0]instanceof l.Point?t:T.toBytes(t)}function aggregateShortSignatures(e){let t=m.aggregateSignatures(e);return e[0]instanceof o.Point?t:v.toBytes(t)}function verifyBatch(e,t,r,i){let n=t.map(e=>normP2Hash(e,i));return y.verifyBatch(e,n,r)}return o.Point.BASE.precompute(4),{longSignatures:y,shortSignatures:m,millerLoopBatch:d,pairing:f,pairingBatch:h,verifyBatch,fields:{Fr:r,Fp:t,Fp2:i,Fp6:n,Fp12:a},params:{ateLoopSize:e.params.ateLoopSize,twistType:e.params.twistType,r:e.params.r,G1b:e.G1.b,G2b:e.G2.b},utils:{randomSecretKey,randomPrivateKey:randomSecretKey,calcPairingPrecomputes:p},getPublicKey,getPublicKeyForShortSignatures,sign,signShortSignature,verify,verifyShortSignature,aggregatePublicKeys,aggregateSignatures,aggregateShortSignatures,G1:o,G2:l,Signature:T,ShortSignature:v}}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */let eW=BigInt(0),eQ=BigInt(1),eX=BigInt(2),eJ=BigInt(3);function calcFrobeniusCoefficients(e,t,r,i,n=1,a){let s=BigInt(void 0===a?i:a),o=r**BigInt(i),c=[];for(let a=0;a<n;a++){let n=BigInt(a+1),l=[];for(let a=0,c=eQ;a<i;a++){let i=(n*c-n)/s%o;l.push(e.pow(t,i)),c*=r}c.push(l)}return c}function psiFrobenius(e,t,r){let i=t.pow(r,(e.ORDER-eQ)/eJ),n=t.pow(r,(e.ORDER-eQ)/eX);function psi(e,r){let a=t.mul(t.frobeniusMap(e,1),i),s=t.mul(t.frobeniusMap(r,1),n);return[a,s]}let a=t.pow(r,(e.ORDER**eX-eQ)/eJ),s=t.pow(r,(e.ORDER**eX-eQ)/eX);if(!t.eql(s,t.neg(t.ONE)))throw Error("psiFrobenius: PSI2_Y!==-1");function psi2(e,r){return[t.mul(e,a),t.neg(r)]}let mapAffine=e=>(t,r)=>{let i=r.toAffine(),n=e(i.x,i.y);return t.fromAffine({x:n[0],y:n[1]})},o=mapAffine(psi),c=mapAffine(psi2);return{psi,psi2,G2psi:o,G2psi2:c,PSI_X:i,PSI_Y:n,PSI2_X:a,PSI2_Y:s}}let Fp2fromBigTuple=(e,t)=>{if(2!==t.length)throw Error("invalid tuple");let r=t.map(t=>e.create(t));return{c0:r[0],c1:r[1]}};let _Field2=class _Field2{constructor(e,t={}){this.MASK=eQ;let r=e.ORDER,i=r*r;this.Fp=e,this.ORDER=i,this.BITS=(0,ek.Dd)(i),this.BYTES=Math.ceil((0,ek.Dd)(i)/8),this.isLE=e.isLE,this.ZERO={c0:e.ZERO,c1:e.ZERO},this.ONE={c0:e.ONE,c1:e.ZERO},this.Fp_NONRESIDUE=e.create(t.NONRESIDUE||BigInt(-1)),this.Fp_div2=e.div(e.ONE,eX),this.NONRESIDUE=Fp2fromBigTuple(e,t.FP2_NONRESIDUE),this.FROBENIUS_COEFFICIENTS=calcFrobeniusCoefficients(e,this.Fp_NONRESIDUE,e.ORDER,2)[0],this.mulByB=t.Fp2mulByB,Object.seal(this)}fromBigTuple(e){return Fp2fromBigTuple(this.Fp,e)}create(e){return e}isValid({c0:e,c1:t}){function isValidC(e,t){return"bigint"==typeof e&&eW<=e&&e<t}return isValidC(e,this.ORDER)&&isValidC(t,this.ORDER)}is0({c0:e,c1:t}){return this.Fp.is0(e)&&this.Fp.is0(t)}isValidNot0(e){return!this.is0(e)&&this.isValid(e)}eql({c0:e,c1:t},{c0:r,c1:i}){return this.Fp.eql(e,r)&&this.Fp.eql(t,i)}neg({c0:e,c1:t}){return{c0:this.Fp.neg(e),c1:this.Fp.neg(t)}}pow(e,t){return e$.Q(this,e,t)}invertBatch(e){return e$.Eg(this,e)}add(e,t){let{c0:r,c1:i}=e,{c0:n,c1:a}=t;return{c0:this.Fp.add(r,n),c1:this.Fp.add(i,a)}}sub({c0:e,c1:t},{c0:r,c1:i}){return{c0:this.Fp.sub(e,r),c1:this.Fp.sub(t,i)}}mul({c0:e,c1:t},r){let{Fp:i}=this;if("bigint"==typeof r)return{c0:i.mul(e,r),c1:i.mul(t,r)};let{c0:n,c1:a}=r,s=i.mul(e,n),o=i.mul(t,a),c=i.sub(s,o),l=i.sub(i.mul(i.add(e,t),i.add(n,a)),i.add(s,o));return{c0:c,c1:l}}sqr({c0:e,c1:t}){let{Fp:r}=this,i=r.add(e,t),n=r.sub(e,t),a=r.add(e,e);return{c0:r.mul(i,n),c1:r.mul(a,t)}}addN(e,t){return this.add(e,t)}subN(e,t){return this.sub(e,t)}mulN(e,t){return this.mul(e,t)}sqrN(e){return this.sqr(e)}div(e,t){let{Fp:r}=this;return this.mul(e,"bigint"==typeof t?r.inv(r.create(t)):this.inv(t))}inv({c0:e,c1:t}){let{Fp:r}=this,i=r.inv(r.create(e*e+t*t));return{c0:r.mul(i,r.create(e)),c1:r.mul(i,r.create(-t))}}sqrt(e){let{Fp:t}=this,{c0:r,c1:i}=e;if(t.is0(i))return 1===e$.IN(t,r)?this.create({c0:t.sqrt(r),c1:t.ZERO}):this.create({c0:t.ZERO,c1:t.sqrt(t.div(r,this.Fp_NONRESIDUE))});let n=t.sqrt(t.sub(t.sqr(r),t.mul(t.sqr(i),this.Fp_NONRESIDUE))),a=t.mul(t.add(n,r),this.Fp_div2),s=e$.IN(t,a);-1===s&&(a=t.sub(a,n));let o=t.sqrt(a),c=this.create({c0:o,c1:t.div(t.mul(i,this.Fp_div2),o)});if(!this.eql(this.sqr(c),e))throw Error("Cannot find square root");let l=this.neg(c),{re:u,im:d}=this.reim(c),{re:f,im:h}=this.reim(l);return d>h||d===h&&u>f?c:l}isOdd(e){let{re:t,im:r}=this.reim(e),i=t%eX,n=r%eX;return BigInt(i||t===eW&&n)==eQ}fromBytes(e){let{Fp:t}=this;if(e.length!==this.BYTES)throw Error("fromBytes invalid length="+e.length);return{c0:t.fromBytes(e.subarray(0,t.BYTES)),c1:t.fromBytes(e.subarray(t.BYTES))}}toBytes({c0:e,c1:t}){return(0,eq.eV)(this.Fp.toBytes(e),this.Fp.toBytes(t))}cmov({c0:e,c1:t},{c0:r,c1:i},n){return{c0:this.Fp.cmov(e,r,n),c1:this.Fp.cmov(t,i,n)}}reim({c0:e,c1:t}){return{re:e,im:t}}Fp4Square(e,t){let r=this.sqr(e),i=this.sqr(t);return{first:this.add(this.mulByNonresidue(i),r),second:this.sub(this.sub(this.sqr(this.add(e,t)),r),i)}}mulByNonresidue({c0:e,c1:t}){return this.mul({c0:e,c1:t},this.NONRESIDUE)}frobeniusMap({c0:e,c1:t},r){return{c0:e,c1:this.Fp.mul(t,this.FROBENIUS_COEFFICIENTS[r%2])}}};let _Field6=class _Field6{constructor(e){this.MASK=eQ,this.Fp2=e,this.ORDER=e.ORDER,this.BITS=3*e.BITS,this.BYTES=3*e.BYTES,this.isLE=e.isLE,this.ZERO={c0:e.ZERO,c1:e.ZERO,c2:e.ZERO},this.ONE={c0:e.ONE,c1:e.ZERO,c2:e.ZERO};let{Fp:t}=e,r=calcFrobeniusCoefficients(e,e.NONRESIDUE,t.ORDER,6,2,3);this.FROBENIUS_COEFFICIENTS_1=r[0],this.FROBENIUS_COEFFICIENTS_2=r[1],Object.seal(this)}add({c0:e,c1:t,c2:r},{c0:i,c1:n,c2:a}){let{Fp2:s}=this;return{c0:s.add(e,i),c1:s.add(t,n),c2:s.add(r,a)}}sub({c0:e,c1:t,c2:r},{c0:i,c1:n,c2:a}){let{Fp2:s}=this;return{c0:s.sub(e,i),c1:s.sub(t,n),c2:s.sub(r,a)}}mul({c0:e,c1:t,c2:r},i){let{Fp2:n}=this;if("bigint"==typeof i)return{c0:n.mul(e,i),c1:n.mul(t,i),c2:n.mul(r,i)};let{c0:a,c1:s,c2:o}=i,c=n.mul(e,a),l=n.mul(t,s),u=n.mul(r,o);return{c0:n.add(c,n.mulByNonresidue(n.sub(n.mul(n.add(t,r),n.add(s,o)),n.add(l,u)))),c1:n.add(n.sub(n.mul(n.add(e,t),n.add(a,s)),n.add(c,l)),n.mulByNonresidue(u)),c2:n.sub(n.add(l,n.mul(n.add(e,r),n.add(a,o))),n.add(c,u))}}sqr({c0:e,c1:t,c2:r}){let{Fp2:i}=this,n=i.sqr(e),a=i.mul(i.mul(e,t),eX),s=i.mul(i.mul(t,r),eX),o=i.sqr(r);return{c0:i.add(i.mulByNonresidue(s),n),c1:i.add(i.mulByNonresidue(o),a),c2:i.sub(i.sub(i.add(i.add(a,i.sqr(i.add(i.sub(e,t),r))),s),n),o)}}addN(e,t){return this.add(e,t)}subN(e,t){return this.sub(e,t)}mulN(e,t){return this.mul(e,t)}sqrN(e){return this.sqr(e)}create(e){return e}isValid({c0:e,c1:t,c2:r}){let{Fp2:i}=this;return i.isValid(e)&&i.isValid(t)&&i.isValid(r)}is0({c0:e,c1:t,c2:r}){let{Fp2:i}=this;return i.is0(e)&&i.is0(t)&&i.is0(r)}isValidNot0(e){return!this.is0(e)&&this.isValid(e)}neg({c0:e,c1:t,c2:r}){let{Fp2:i}=this;return{c0:i.neg(e),c1:i.neg(t),c2:i.neg(r)}}eql({c0:e,c1:t,c2:r},{c0:i,c1:n,c2:a}){let{Fp2:s}=this;return s.eql(e,i)&&s.eql(t,n)&&s.eql(r,a)}sqrt(e){return(0,ek.EQ)()}div(e,t){let{Fp2:r}=this,{Fp:i}=r;return this.mul(e,"bigint"==typeof t?i.inv(i.create(t)):this.inv(t))}pow(e,t){return e$.Q(this,e,t)}invertBatch(e){return e$.Eg(this,e)}inv({c0:e,c1:t,c2:r}){let{Fp2:i}=this,n=i.sub(i.sqr(e),i.mulByNonresidue(i.mul(r,t))),a=i.sub(i.mulByNonresidue(i.sqr(r)),i.mul(e,t)),s=i.sub(i.sqr(t),i.mul(e,r)),o=i.inv(i.add(i.mulByNonresidue(i.add(i.mul(r,a),i.mul(t,s))),i.mul(e,n)));return{c0:i.mul(o,n),c1:i.mul(o,a),c2:i.mul(o,s)}}fromBytes(e){let{Fp2:t}=this;if(e.length!==this.BYTES)throw Error("fromBytes invalid length="+e.length);let r=t.BYTES;return{c0:t.fromBytes(e.subarray(0,r)),c1:t.fromBytes(e.subarray(r,2*r)),c2:t.fromBytes(e.subarray(2*r))}}toBytes({c0:e,c1:t,c2:r}){let{Fp2:i}=this;return(0,eq.eV)(i.toBytes(e),i.toBytes(t),i.toBytes(r))}cmov({c0:e,c1:t,c2:r},{c0:i,c1:n,c2:a},s){let{Fp2:o}=this;return{c0:o.cmov(e,i,s),c1:o.cmov(t,n,s),c2:o.cmov(r,a,s)}}fromBigSix(e){let{Fp2:t}=this;if(!Array.isArray(e)||6!==e.length)throw Error("invalid Fp6 usage");return{c0:t.fromBigTuple(e.slice(0,2)),c1:t.fromBigTuple(e.slice(2,4)),c2:t.fromBigTuple(e.slice(4,6))}}frobeniusMap({c0:e,c1:t,c2:r},i){let{Fp2:n}=this;return{c0:n.frobeniusMap(e,i),c1:n.mul(n.frobeniusMap(t,i),this.FROBENIUS_COEFFICIENTS_1[i%6]),c2:n.mul(n.frobeniusMap(r,i),this.FROBENIUS_COEFFICIENTS_2[i%6])}}mulByFp2({c0:e,c1:t,c2:r},i){let{Fp2:n}=this;return{c0:n.mul(e,i),c1:n.mul(t,i),c2:n.mul(r,i)}}mulByNonresidue({c0:e,c1:t,c2:r}){let{Fp2:i}=this;return{c0:i.mulByNonresidue(r),c1:e,c2:t}}mul1({c0:e,c1:t,c2:r},i){let{Fp2:n}=this;return{c0:n.mulByNonresidue(n.mul(r,i)),c1:n.mul(e,i),c2:n.mul(t,i)}}mul01({c0:e,c1:t,c2:r},i,n){let{Fp2:a}=this,s=a.mul(e,i),o=a.mul(t,n);return{c0:a.add(a.mulByNonresidue(a.sub(a.mul(a.add(t,r),n),o)),s),c1:a.sub(a.sub(a.mul(a.add(i,n),a.add(e,t)),s),o),c2:a.add(a.sub(a.mul(a.add(e,r),i),s),o)}}};let _Field12=class _Field12{constructor(e,t){this.MASK=eQ;let{Fp2:r}=e,{Fp:i}=r;this.Fp6=e,this.ORDER=r.ORDER,this.BITS=2*e.BITS,this.BYTES=2*e.BYTES,this.isLE=e.isLE,this.ZERO={c0:e.ZERO,c1:e.ZERO},this.ONE={c0:e.ONE,c1:e.ZERO},this.FROBENIUS_COEFFICIENTS=calcFrobeniusCoefficients(r,r.NONRESIDUE,i.ORDER,12,1,6)[0],this.X_LEN=t.X_LEN,this.finalExponentiate=t.Fp12finalExponentiate}create(e){return e}isValid({c0:e,c1:t}){let{Fp6:r}=this;return r.isValid(e)&&r.isValid(t)}is0({c0:e,c1:t}){let{Fp6:r}=this;return r.is0(e)&&r.is0(t)}isValidNot0(e){return!this.is0(e)&&this.isValid(e)}neg({c0:e,c1:t}){let{Fp6:r}=this;return{c0:r.neg(e),c1:r.neg(t)}}eql({c0:e,c1:t},{c0:r,c1:i}){let{Fp6:n}=this;return n.eql(e,r)&&n.eql(t,i)}sqrt(e){(0,ek.EQ)()}inv({c0:e,c1:t}){let{Fp6:r}=this,i=r.inv(r.sub(r.sqr(e),r.mulByNonresidue(r.sqr(t))));return{c0:r.mul(e,i),c1:r.neg(r.mul(t,i))}}div(e,t){let{Fp6:r}=this,{Fp2:i}=r,{Fp:n}=i;return this.mul(e,"bigint"==typeof t?n.inv(n.create(t)):this.inv(t))}pow(e,t){return e$.Q(this,e,t)}invertBatch(e){return e$.Eg(this,e)}add({c0:e,c1:t},{c0:r,c1:i}){let{Fp6:n}=this;return{c0:n.add(e,r),c1:n.add(t,i)}}sub({c0:e,c1:t},{c0:r,c1:i}){let{Fp6:n}=this;return{c0:n.sub(e,r),c1:n.sub(t,i)}}mul({c0:e,c1:t},r){let{Fp6:i}=this;if("bigint"==typeof r)return{c0:i.mul(e,r),c1:i.mul(t,r)};let{c0:n,c1:a}=r,s=i.mul(e,n),o=i.mul(t,a);return{c0:i.add(s,i.mulByNonresidue(o)),c1:i.sub(i.mul(i.add(e,t),i.add(n,a)),i.add(s,o))}}sqr({c0:e,c1:t}){let{Fp6:r}=this,i=r.mul(e,t);return{c0:r.sub(r.sub(r.mul(r.add(r.mulByNonresidue(t),e),r.add(e,t)),i),r.mulByNonresidue(i)),c1:r.add(i,i)}}addN(e,t){return this.add(e,t)}subN(e,t){return this.sub(e,t)}mulN(e,t){return this.mul(e,t)}sqrN(e){return this.sqr(e)}fromBytes(e){let{Fp6:t}=this;if(e.length!==this.BYTES)throw Error("fromBytes invalid length="+e.length);return{c0:t.fromBytes(e.subarray(0,t.BYTES)),c1:t.fromBytes(e.subarray(t.BYTES))}}toBytes({c0:e,c1:t}){let{Fp6:r}=this;return(0,eq.eV)(r.toBytes(e),r.toBytes(t))}cmov({c0:e,c1:t},{c0:r,c1:i},n){let{Fp6:a}=this;return{c0:a.cmov(e,r,n),c1:a.cmov(t,i,n)}}fromBigTwelve(e){let{Fp6:t}=this;return{c0:t.fromBigSix(e.slice(0,6)),c1:t.fromBigSix(e.slice(6,12))}}frobeniusMap(e,t){let{Fp6:r}=this,{Fp2:i}=r,{c0:n,c1:a,c2:s}=r.frobeniusMap(e.c1,t),o=this.FROBENIUS_COEFFICIENTS[t%12];return{c0:r.frobeniusMap(e.c0,t),c1:r.create({c0:i.mul(n,o),c1:i.mul(a,o),c2:i.mul(s,o)})}}mulByFp2({c0:e,c1:t},r){let{Fp6:i}=this;return{c0:i.mulByFp2(e,r),c1:i.mulByFp2(t,r)}}conjugate({c0:e,c1:t}){return{c0:e,c1:this.Fp6.neg(t)}}mul014({c0:e,c1:t},r,i,n){let{Fp6:a}=this,{Fp2:s}=a,o=a.mul01(e,r,i),c=a.mul1(t,n);return{c0:a.add(a.mulByNonresidue(c),o),c1:a.sub(a.sub(a.mul01(a.add(t,e),r,s.add(i,n)),o),c)}}mul034({c0:e,c1:t},r,i,n){let{Fp6:a}=this,{Fp2:s}=a,o=a.create({c0:s.mul(e.c0,r),c1:s.mul(e.c1,r),c2:s.mul(e.c2,r)}),c=a.mul01(t,i,n),l=a.mul01(a.add(e,t),s.add(r,i),n);return{c0:a.add(a.mulByNonresidue(c),o),c1:a.sub(l,a.add(o,c))}}_cyclotomicSquare({c0:e,c1:t}){let{Fp6:r}=this,{Fp2:i}=r,{c0:n,c1:a,c2:s}=e,{c0:o,c1:c,c2:l}=t,{first:u,second:d}=i.Fp4Square(n,c),{first:f,second:h}=i.Fp4Square(o,s),{first:p,second:y}=i.Fp4Square(a,l),m=i.mulByNonresidue(y);return{c0:r.create({c0:i.add(i.mul(i.sub(u,n),eX),u),c1:i.add(i.mul(i.sub(f,a),eX),f),c2:i.add(i.mul(i.sub(p,s),eX),p)}),c1:r.create({c0:i.add(i.mul(i.add(m,o),eX),m),c1:i.add(i.mul(i.add(d,c),eX),d),c2:i.add(i.mul(i.add(h,l),eX),h)})}}_cyclotomicExp(e,t){let r=this.ONE;for(let i=this.X_LEN-1;i>=0;i--)r=this._cyclotomicSquare(r),(0,ek.H_)(t,i)&&(r=this.mul(r,e));return r}};function tower12(e){let t=e$.gN(e.ORDER),r=new _Field2(t,e),i=new _Field6(r),n=new _Field12(i,e);return{Fp:t,Fp2:r,Fp6:i,Fp12:n}}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */let e0=BigInt(0),e1=BigInt(1),e2=BigInt(2),e8=BigInt(3),e3=BigInt(4),e6=BigInt("0xd201000000010000"),e4=(0,ek.Dd)(e6),e5={p:BigInt("0x1a0111ea397fe69a4b1ba7b6434bacd764774b84f38512bf6730d2a0f6b0f6241eabfffeb153ffffb9feffffffffaaab"),n:BigInt("0x73eda753299d7d483339d80809a1d80553bda402fffe5bfeffffffff00000001"),h:BigInt("0x396c8c005555e1568c00aaab0000aaab"),a:e0,b:e3,Gx:BigInt("0x17f1d3a73197d7942695638c4fa9ac0fc3688c4f9774b905a14e3a3f171bac586c55e83ff97a1aeffb3af00adb22c6bb"),Gy:BigInt("0x08b3f481e3aaa0f1a09e30ed741d8ae4fcf5e095d5d00af600db18cb2c04b3edd03cc744a2888ae40caa232946c5e7e1")},e9=(0,e$.gN)(e5.n,{modFromBytes:!0,isLE:!0}),{Fp:e7,Fp2:te,Fp6:tr,Fp12:ti}=tower12({ORDER:e5.p,X_LEN:e4,FP2_NONRESIDUE:[e1,e1],Fp2mulByB:({c0:e,c1:t})=>{let r=e7.mul(e,e3),i=e7.mul(t,e3);return{c0:e7.sub(r,i),c1:e7.add(r,i)}},Fp12finalExponentiate:e=>{let t=ti.div(ti.frobeniusMap(e,6),e),r=ti.mul(ti.frobeniusMap(t,2),t),i=ti.conjugate(ti._cyclotomicExp(r,e6)),n=ti.mul(ti.conjugate(ti._cyclotomicSquare(r)),i),a=ti.conjugate(ti._cyclotomicExp(n,e6)),s=ti.conjugate(ti._cyclotomicExp(a,e6)),o=ti.mul(ti.conjugate(ti._cyclotomicExp(s,e6)),ti._cyclotomicSquare(i)),c=ti.conjugate(ti._cyclotomicExp(o,e6)),l=ti.frobeniusMap(ti.mul(i,s),2),u=ti.frobeniusMap(ti.mul(a,r),3),d=ti.frobeniusMap(ti.mul(o,ti.conjugate(r)),1),f=ti.mul(ti.mul(c,ti.conjugate(n)),r);return ti.mul(ti.mul(ti.mul(l,u),d),f)}}),{G2psi:tn,G2psi2:ta}=psiFrobenius(e7,te,te.div(te.ONE,te.NONRESIDUE)),ts=Object.freeze({DST:"BLS_SIG_BLS12381G2_XMD:SHA-256_SSWU_RO_NUL_",encodeDST:"BLS_SIG_BLS12381G2_XMD:SHA-256_SSWU_RO_NUL_",p:e7.ORDER,m:2,k:128,expand:"xmd",hash:eA.JQ}),to={p:te.ORDER,n:e5.n,h:BigInt("0x5d543a95414e7f1091d50792876a202cd91de4547085abaa68a205b2e5a7ddfa628f1cb4d9e82ef21537e293a6691ae1616ec6e786f0c70cf1c38e31c7238e5"),a:te.ZERO,b:te.fromBigTuple([e3,e3]),Gx:te.fromBigTuple([BigInt("0x024aa2b2f08f0a91260805272dc51051c6e47ad4fa403b02b4510b647ae3d1770bac0326a805bbefd48056c8c121bdb8"),BigInt("0x13e02b6052719f607dacd3a088274f65596bd0d09920b61ab5da61bbdc7f5049334cf11213945d57e5ac7d055d042b7e")]),Gy:te.fromBigTuple([BigInt("0x0ce5d527727d6e118cc9cdc6da2e351aadfd9baa8cbdd3a76d429a695160d12c923ac9cc3baca289e193548608b82801"),BigInt("0x0606c4a02ea734cc32acd2b02bc28b99cb3e287e85a763af267492ab572e99ab3f370d275cec1da1aaa9075ff05f79be")])},tc=setMask(e7.toBytes(e0),{infinity:!0,compressed:!0});function parseMask(e){e=e.slice();let t=224&e[0];return e[0]&=31,{compressed:!!(t>>7&1),infinity:!!(t>>6&1),sort:!!(t>>5&1),value:e}}function setMask(e,t){if(224&e[0])throw Error("setMask: non-empty mask");return t.compressed&&(e[0]|=128),t.infinity&&(e[0]|=64),t.sort&&(e[0]|=32),e}function pointG1ToBytes(e,t,r){let{BYTES:i,ORDER:n}=e7,a=t.is0(),{x:s,y:o}=t.toAffine();if(r){if(a)return tc.slice();let e=!!(o*e2/n);return setMask((0,ek.tL)(s,i),{compressed:!0,sort:e})}return a?(0,eq.eV)(Uint8Array.of(64),new Uint8Array(2*i-1)):(0,eq.eV)((0,ek.tL)(s,i),(0,ek.tL)(o,i))}function signatureG1ToBytes(e){e.assertValidity();let{BYTES:t,ORDER:r}=e7,{x:i,y:n}=e.toAffine();return e.is0()?tc.slice():setMask((0,ek.tL)(i,t),{compressed:!0,sort:!!(n*e2/r)})}function pointG1FromBytes(e){let{compressed:t,infinity:r,sort:i,value:n}=parseMask(e),{BYTES:a,ORDER:s}=e7;if(48===n.length&&t){let e=(0,ek.Hv)(n),t=e7.create(e&(0,ek.dQ)(e7.BITS));if(r){if(t!==e0)throw Error("invalid G1 point: non-empty, at infinity, with compression");return{x:e0,y:e0}}let a=e7.add(e7.pow(t,e8),e7.create(e5.b)),o=e7.sqrt(a);if(!o)throw Error("invalid G1 point: compressed point");return o*e2/s!==BigInt(i)&&(o=e7.neg(o)),{x:e7.create(t),y:e7.create(o)}}if(96!==n.length||t)throw Error("invalid G1 point: expected 48/96 bytes");{let e=(0,ek.Hv)(n.subarray(0,a)),t=(0,ek.Hv)(n.subarray(a));if(r){if(e!==e0||t!==e0)throw Error("G1: non-empty point at infinity");return tl.G1.Point.ZERO.toAffine()}return{x:e7.create(e),y:e7.create(t)}}}function signatureG1FromBytes(e){let{infinity:t,sort:r,value:i}=parseMask((0,ek.ql)("signatureHex",e,48)),n=e7.ORDER,a=tl.G1.Point,s=(0,ek.Hv)(i);if(t)return a.ZERO;let o=e7.create(s&(0,ek.dQ)(e7.BITS)),c=e7.add(e7.pow(o,e8),e7.create(e5.b)),l=e7.sqrt(c);if(!l)throw Error("invalid G1 point: compressed");let u=BigInt(r);l*e2/n!==u&&(l=e7.neg(l));let d=a.fromAffine({x:o,y:l});return d.assertValidity(),d}function pointG2ToBytes(e,t,r){let{BYTES:i,ORDER:n}=e7,a=t.is0(),{x:s,y:o}=t.toAffine();if(r){if(a)return(0,eq.eV)(tc,(0,ek.tL)(e0,i));let e=!!(o.c1===e0?o.c0*e2/n:o.c1*e2/n);return(0,eq.eV)(setMask((0,ek.tL)(s.c1,i),{compressed:!0,sort:e}),(0,ek.tL)(s.c0,i))}{if(a)return(0,eq.eV)(Uint8Array.of(64),new Uint8Array(4*i-1));let{re:e,im:t}=te.reim(s),{re:r,im:n}=te.reim(o);return(0,eq.eV)((0,ek.tL)(t,i),(0,ek.tL)(e,i),(0,ek.tL)(n,i),(0,ek.tL)(r,i))}}function signatureG2ToBytes(e){e.assertValidity();let{BYTES:t}=e7;if(e.is0())return(0,eq.eV)(tc,(0,ek.tL)(e0,t));let{x:r,y:i}=e.toAffine(),{re:n,im:a}=te.reim(r),{re:s,im:o}=te.reim(i),c=o>e0?o*e2:s*e2,l=!!(c/e7.ORDER&e1);return(0,eq.eV)(setMask((0,ek.tL)(a,t),{sort:l,compressed:!0}),(0,ek.tL)(n,t))}function pointG2FromBytes(e){let{BYTES:t,ORDER:r}=e7,{compressed:i,infinity:n,sort:a,value:s}=parseMask(e);if(!i&&!n&&a||!i&&n&&a||a&&n&&i)throw Error("invalid encoding flag: "+(224&e[0]));let slc=(e,t,r)=>(0,ek.Hv)(e.slice(t,r));if(96===s.length&&i){if(n){if(s.reduce((e,t)=>0!==e?t+1:t,0)>0)throw Error("invalid G2 point: compressed");return{x:te.ZERO,y:te.ZERO}}let e=slc(s,0,t),i=slc(s,t,2*t),o=te.create({c0:e7.create(i),c1:e7.create(e)}),c=te.add(te.pow(o,e8),to.b),l=te.sqrt(c),u=l.c1===e0?l.c0*e2/r:l.c1*e2/r?e1:e0;return{x:o,y:l=a&&u>0?l:te.neg(l)}}if(192!==s.length||i)throw Error("invalid G2 point: expected 96/192 bytes");{if(n){if(s.reduce((e,t)=>0!==e?t+1:t,0)>0)throw Error("invalid G2 point: uncompressed");return{x:te.ZERO,y:te.ZERO}}let e=slc(s,0*t,1*t),r=slc(s,1*t,2*t),i=slc(s,2*t,3*t),a=slc(s,3*t,4*t);return{x:te.fromBigTuple([r,e]),y:te.fromBigTuple([a,i])}}}function signatureG2FromBytes(e){let{ORDER:t}=e7,{infinity:r,sort:i,value:n}=parseMask((0,ek.ql)("signatureHex",e)),a=tl.G2.Point,s=n.length/2;if(48!==s&&96!==s)throw Error("invalid compressed signature length, expected 96/192 bytes");let o=(0,ek.Hv)(n.slice(0,s)),c=(0,ek.Hv)(n.slice(s));if(r)return a.ZERO;let l=e7.create(o&(0,ek.dQ)(e7.BITS)),u=e7.create(c),d=te.create({c0:u,c1:l}),f=te.add(te.pow(d,e8),to.b),h=te.sqrt(f);if(!h)throw Error("Failed to find a square root");let{re:p,im:y}=te.reim(h),m=BigInt(i),g=y>e0&&y*e2/t!==m,v=y===e0&&p*e2/t!==m;(g||v)&&(h=te.neg(h));let T=a.fromAffine({x:d,y:h});return T.assertValidity(),T}let tl=bls({fields:{Fp:e7,Fp2:te,Fp6:tr,Fp12:ti,Fr:e9},G1:{...e5,Fp:e7,htfDefaults:{...ts,m:1,DST:"BLS_SIG_BLS12381G1_XMD:SHA-256_SSWU_RO_NUL_"},wrapPrivateKey:!0,allowInfinityPoint:!0,isTorsionFree:(e,t)=>{let r=BigInt("0x5f19672fdf76ce51ba69c6076a0f77eaddb3a93be6f89688de17d813620a00022e01fffffffefffe"),i=new e(e7.mul(t.X,r),t.Y,t.Z),n=t.multiplyUnsafe(e6).negate(),a=n.multiplyUnsafe(e6);return a.equals(i)},clearCofactor:(e,t)=>t.multiplyUnsafe(e6).add(t),mapToCurve:mapToG1,fromBytes:pointG1FromBytes,toBytes:pointG1ToBytes,ShortSignature:{fromBytes:e=>((0,eq.gk)(e),signatureG1FromBytes(e)),fromHex:e=>signatureG1FromBytes(e),toBytes:e=>signatureG1ToBytes(e),toRawBytes:e=>signatureG1ToBytes(e),toHex:e=>(0,eq.ci)(signatureG1ToBytes(e))}},G2:{...to,Fp:te,hEff:BigInt("0xbc69f08f2ee75b3584c6a0ea91b352888e2a8e9145ad7689986ff031508ffe1329c2f178731db956d82bf015d1212b02ec0ec69d7477c1ae954cbc06689f6a359894c0adebbf6b4e8020005aaa95551"),htfDefaults:{...ts},wrapPrivateKey:!0,allowInfinityPoint:!0,mapToCurve:mapToG2,isTorsionFree:(e,t)=>t.multiplyUnsafe(e6).negate().equals(tn(e,t)),clearCofactor:(e,t)=>{let r=t.multiplyUnsafe(e6).negate(),i=tn(e,t),n=t.double();n=(n=ta(e,n)).subtract(i),i=(i=r.add(i)).multiplyUnsafe(e6).negate(),n=(n=n.add(i)).subtract(r);let a=n.subtract(t);return a},fromBytes:pointG2FromBytes,toBytes:pointG2ToBytes,Signature:{fromBytes:e=>((0,eq.gk)(e),signatureG2FromBytes(e)),fromHex:e=>signatureG2FromBytes(e),toBytes:e=>signatureG2ToBytes(e),toRawBytes:e=>signatureG2ToBytes(e),toHex:e=>(0,eq.ci)(signatureG2ToBytes(e))}},params:{ateLoopSize:e6,r:e5.n,xNegative:!0,twistType:"multiplicative"},htfDefaults:ts,hash:eA.JQ}),tu=(0,eD.i)(te,[[["0x5c759507e8e333ebb5b7a9a47d7ed8532c52d39fd3a042a88b58423c50ae15d5c2638e343d9c71c6238aaaaaaaa97d6","0x5c759507e8e333ebb5b7a9a47d7ed8532c52d39fd3a042a88b58423c50ae15d5c2638e343d9c71c6238aaaaaaaa97d6"],["0x0","0x11560bf17baa99bc32126fced787c88f984f87adf7ae0c7f9a208c6b4f20a4181472aaa9cb8d555526a9ffffffffc71a"],["0x11560bf17baa99bc32126fced787c88f984f87adf7ae0c7f9a208c6b4f20a4181472aaa9cb8d555526a9ffffffffc71e","0x8ab05f8bdd54cde190937e76bc3e447cc27c3d6fbd7063fcd104635a790520c0a395554e5c6aaaa9354ffffffffe38d"],["0x171d6541fa38ccfaed6dea691f5fb614cb14b4e7f4e810aa22d6108f142b85757098e38d0f671c7188e2aaaaaaaa5ed1","0x0"]],[["0x0","0x1a0111ea397fe69a4b1ba7b6434bacd764774b84f38512bf6730d2a0f6b0f6241eabfffeb153ffffb9feffffffffaa63"],["0xc","0x1a0111ea397fe69a4b1ba7b6434bacd764774b84f38512bf6730d2a0f6b0f6241eabfffeb153ffffb9feffffffffaa9f"],["0x1","0x0"]],[["0x1530477c7ab4113b59a4c18b076d11930f7da5d4a07f649bf54439d87d27e500fc8c25ebf8c92f6812cfc71c71c6d706","0x1530477c7ab4113b59a4c18b076d11930f7da5d4a07f649bf54439d87d27e500fc8c25ebf8c92f6812cfc71c71c6d706"],["0x0","0x5c759507e8e333ebb5b7a9a47d7ed8532c52d39fd3a042a88b58423c50ae15d5c2638e343d9c71c6238aaaaaaaa97be"],["0x11560bf17baa99bc32126fced787c88f984f87adf7ae0c7f9a208c6b4f20a4181472aaa9cb8d555526a9ffffffffc71c","0x8ab05f8bdd54cde190937e76bc3e447cc27c3d6fbd7063fcd104635a790520c0a395554e5c6aaaa9354ffffffffe38f"],["0x124c9ad43b6cf79bfbf7043de3811ad0761b0f37a1e26286b0e977c69aa274524e79097a56dc4bd9e1b371c71c718b10","0x0"]],[["0x1a0111ea397fe69a4b1ba7b6434bacd764774b84f38512bf6730d2a0f6b0f6241eabfffeb153ffffb9feffffffffa8fb","0x1a0111ea397fe69a4b1ba7b6434bacd764774b84f38512bf6730d2a0f6b0f6241eabfffeb153ffffb9feffffffffa8fb"],["0x0","0x1a0111ea397fe69a4b1ba7b6434bacd764774b84f38512bf6730d2a0f6b0f6241eabfffeb153ffffb9feffffffffa9d3"],["0x12","0x1a0111ea397fe69a4b1ba7b6434bacd764774b84f38512bf6730d2a0f6b0f6241eabfffeb153ffffb9feffffffffaa99"],["0x1","0x0"]]].map(e=>e.map(e=>te.fromBigTuple(e.map(BigInt))))),td=(0,eD.i)(e7,[["0x11a05f2b1e833340b809101dd99815856b303e88a2d7005ff2627b56cdb4e2c85610c2d5f2e62d6eaeac1662734649b7","0x17294ed3e943ab2f0588bab22147a81c7c17e75b2f6a8417f565e33c70d1e86b4838f2a6f318c356e834eef1b3cb83bb","0xd54005db97678ec1d1048c5d10a9a1bce032473295983e56878e501ec68e25c958c3e3d2a09729fe0179f9dac9edcb0","0x1778e7166fcc6db74e0609d307e55412d7f5e4656a8dbf25f1b33289f1b330835336e25ce3107193c5b388641d9b6861","0xe99726a3199f4436642b4b3e4118e5499db995a1257fb3f086eeb65982fac18985a286f301e77c451154ce9ac8895d9","0x1630c3250d7313ff01d1201bf7a74ab5db3cb17dd952799b9ed3ab9097e68f90a0870d2dcae73d19cd13c1c66f652983","0xd6ed6553fe44d296a3726c38ae652bfb11586264f0f8ce19008e218f9c86b2a8da25128c1052ecaddd7f225a139ed84","0x17b81e7701abdbe2e8743884d1117e53356de5ab275b4db1a682c62ef0f2753339b7c8f8c8f475af9ccb5618e3f0c88e","0x80d3cf1f9a78fc47b90b33563be990dc43b756ce79f5574a2c596c928c5d1de4fa295f296b74e956d71986a8497e317","0x169b1f8e1bcfa7c42e0c37515d138f22dd2ecb803a0c5c99676314baf4bb1b7fa3190b2edc0327797f241067be390c9e","0x10321da079ce07e272d8ec09d2565b0dfa7dccdde6787f96d50af36003b14866f69b771f8c285decca67df3f1605fb7b","0x6e08c248e260e70bd1e962381edee3d31d79d7e22c837bc23c0bf1bc24c6b68c24b1b80b64d391fa9c8ba2e8ba2d229"],["0x8ca8d548cff19ae18b2e62f4bd3fa6f01d5ef4ba35b48ba9c9588617fc8ac62b558d681be343df8993cf9fa40d21b1c","0x12561a5deb559c4348b4711298e536367041e8ca0cf0800c0126c2588c48bf5713daa8846cb026e9e5c8276ec82b3bff","0xb2962fe57a3225e8137e629bff2991f6f89416f5a718cd1fca64e00b11aceacd6a3d0967c94fedcfcc239ba5cb83e19","0x3425581a58ae2fec83aafef7c40eb545b08243f16b1655154cca8abc28d6fd04976d5243eecf5c4130de8938dc62cd8","0x13a8e162022914a80a6f1d5f43e7a07dffdfc759a12062bb8d6b44e833b306da9bd29ba81f35781d539d395b3532a21e","0xe7355f8e4e667b955390f7f0506c6e9395735e9ce9cad4d0a43bcef24b8982f7400d24bc4228f11c02df9a29f6304a5","0x772caacf16936190f3e0c63e0596721570f5799af53a1894e2e073062aede9cea73b3538f0de06cec2574496ee84a3a","0x14a7ac2a9d64a8b230b3f5b074cf01996e7f63c21bca68a81996e1cdf9822c580fa5b9489d11e2d311f7d99bbdcc5a5e","0xa10ecf6ada54f825e920b3dafc7a3cce07f8d1d7161366b74100da67f39883503826692abba43704776ec3a79a1d641","0x95fc13ab9e92ad4476d6e3eb3a56680f682b4ee96f7d03776df533978f31c1593174e4b4b7865002d6384d168ecdd0a","0x000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001"],["0x90d97c81ba24ee0259d1f094980dcfa11ad138e48a869522b52af6c956543d3cd0c7aee9b3ba3c2be9845719707bb33","0x134996a104ee5811d51036d776fb46831223e96c254f383d0f906343eb67ad34d6c56711962fa8bfe097e75a2e41c696","0xcc786baa966e66f4a384c86a3b49942552e2d658a31ce2c344be4b91400da7d26d521628b00523b8dfe240c72de1f6","0x1f86376e8981c217898751ad8746757d42aa7b90eeb791c09e4a3ec03251cf9de405aba9ec61deca6355c77b0e5f4cb","0x8cc03fdefe0ff135caf4fe2a21529c4195536fbe3ce50b879833fd221351adc2ee7f8dc099040a841b6daecf2e8fedb","0x16603fca40634b6a2211e11db8f0a6a074a7d0d4afadb7bd76505c3d3ad5544e203f6326c95a807299b23ab13633a5f0","0x4ab0b9bcfac1bbcb2c977d027796b3ce75bb8ca2be184cb5231413c4d634f3747a87ac2460f415ec961f8855fe9d6f2","0x987c8d5333ab86fde9926bd2ca6c674170a05bfe3bdd81ffd038da6c26c842642f64550fedfe935a15e4ca31870fb29","0x9fc4018bd96684be88c9e221e4da1bb8f3abd16679dc26c1e8b6e6a1f20cabe69d65201c78607a360370e577bdba587","0xe1bba7a1186bdb5223abde7ada14a23c42a0ca7915af6fe06985e7ed1e4d43b9b3f7055dd4eba6f2bafaaebca731c30","0x19713e47937cd1be0dfd0b8f1d43fb93cd2fcbcb6caf493fd1183e416389e61031bf3a5cce3fbafce813711ad011c132","0x18b46a908f36f6deb918c143fed2edcc523559b8aaf0c2462e6bfe7f911f643249d9cdf41b44d606ce07c8a4d0074d8e","0xb182cac101b9399d155096004f53f447aa7b12a3426b08ec02710e807b4633f06c851c1919211f20d4c04f00b971ef8","0x245a394ad1eca9b72fc00ae7be315dc757b3b080d4c158013e6632d3c40659cc6cf90ad1c232a6442d9d3f5db980133","0x5c129645e44cf1102a159f748c4a3fc5e673d81d7e86568d9ab0f5d396a7ce46ba1049b6579afb7866b1e715475224b","0x15e6be4e990f03ce4ea50b3b42df2eb5cb181d8f84965a3957add4fa95af01b2b665027efec01c7704b456be69c8b604"],["0x16112c4c3a9c98b252181140fad0eae9601a6de578980be6eec3232b5be72e7a07f3688ef60c206d01479253b03663c1","0x1962d75c2381201e1a0cbd6c43c348b885c84ff731c4d59ca4a10356f453e01f78a4260763529e3532f6102c2e49a03d","0x58df3306640da276faaae7d6e8eb15778c4855551ae7f310c35a5dd279cd2eca6757cd636f96f891e2538b53dbf67f2","0x16b7d288798e5395f20d23bf89edb4d1d115c5dbddbcd30e123da489e726af41727364f2c28297ada8d26d98445f5416","0xbe0e079545f43e4b00cc912f8228ddcc6d19c9f0f69bbb0542eda0fc9dec916a20b15dc0fd2ededda39142311a5001d","0x8d9e5297186db2d9fb266eaac783182b70152c65550d881c5ecd87b6f0f5a6449f38db9dfa9cce202c6477faaf9b7ac","0x166007c08a99db2fc3ba8734ace9824b5eecfdfa8d0cf8ef5dd365bc400a0051d5fa9c01a58b1fb93d1a1399126a775c","0x16a3ef08be3ea7ea03bcddfabba6ff6ee5a4375efa1f4fd7feb34fd206357132b920f5b00801dee460ee415a15812ed9","0x1866c8ed336c61231a1be54fd1d74cc4f9fb0ce4c6af5920abc5750c4bf39b4852cfe2f7bb9248836b233d9d55535d4a","0x167a55cda70a6e1cea820597d94a84903216f763e13d87bb5308592e7ea7d4fbc7385ea3d529b35e346ef48bb8913f55","0x4d2f259eea405bd48f010a01ad2911d9c6dd039bb61a6290e591b36e636a5c871a5c29f4f83060400f8b49cba8f6aa8","0xaccbb67481d033ff5852c1e48c50c477f94ff8aefce42d28c0f9a88cea7913516f968986f7ebbea9684b529e2561092","0xad6b9514c767fe3c3613144b45f1496543346d98adf02267d5ceef9a00d9b8693000763e3b90ac11e99b138573345cc","0x2660400eb2e4f3b628bdd0d53cd76f2bf565b94e72927c1cb748df27942480e420517bd8714cc80d1fadc1326ed06f7","0xe0fa1d816ddc03e6b24255e0d7819c171c40f65e273b853324efcd6356caa205ca2f570f13497804415473a1d634b8f","0x000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001"]].map(e=>e.map(e=>BigInt(e)))),tf=mapToCurveSimpleSWU(e7,{A:e7.create(BigInt("0x144698a3b8e9433d693a02c96d4982b0ea985383ee66a8d8e8981aefd881ac98936f8da0e0f97f5cf428082d584c1d")),B:e7.create(BigInt("0x12e2908d11688030018b12e8753eee3b2016c1f0f24f4070a0b9c14fcef35ef55a23215a316ceaa5d1cc48e98e172be0")),Z:e7.create(BigInt(11))}),th=mapToCurveSimpleSWU(te,{A:te.create({c0:e7.create(e0),c1:e7.create(BigInt(240))}),B:te.create({c0:e7.create(BigInt(1012)),c1:e7.create(BigInt(1012))}),Z:te.create({c0:e7.create(BigInt(-2)),c1:e7.create(BigInt(-1))})});function mapToG1(e){let{x:t,y:r}=tf(e7.create(e[0]));return td(t,r)}function mapToG2(e){let{x:t,y:r}=th(te.fromBigTuple(e));return tu(t,r)}function blsVerify(e,t,r){let i="string"==typeof e?e:(0,eq.ci)(e),n="string"==typeof t?t:(0,eq.ci)(t),a="string"==typeof r?r:(0,eq.ci)(r);return tl.verifyShortSignature(n,a,i)}let tp=BigInt(1e6),decodeLeb128=e=>(0,A.aC)(new P.P8(e)),decodeTime=e=>{let t=decodeLeb128(e);return new Date(Number(t/tp))};var ty=r(7733);function isBufferGreaterThan(e,t){for(let r=0;r<e.length;r++)if(e[r]>t[r])return!0;return!1}!function(e){e[e.Empty=0]="Empty",e[e.Fork=1]="Fork",e[e.Labeled=2]="Labeled",e[e.Leaf=3]="Leaf",e[e.Pruned=4]="Pruned"}(h||(h={}));let Certificate=class Certificate{#e=!1;#t=void 0;static async create(e){let t=Certificate.createUnverified(e);return await t.verify(),t}static createUnverified(e){return new Certificate(e.certificate,e.rootKey,e.canisterId,e.blsVerify??blsVerify,e.maxAgeInMinutes,e.disableTimeVerification,e.agent)}constructor(e,t,r,i,n=5,a=!1,s){this._rootKey=t,this._canisterId=r,this._blsVerify=i,this._maxAgeInMinutes=n,this.#e=a,this.cert=cbor_decode(e),s&&"getTimeDiffMsecs"in s&&"hasSyncedTime"in s&&"syncTime"in s&&(this.#t=s)}lookup_path(e){return lookup_path(e,this.cert.tree)}lookup_subtree(e){return lookup_subtree(e,this.cert.tree)}async verify(){let e=await reconstruct(this.cert.tree),t=await this._checkDelegationAndGetKey(this.cert.delegation),r=this.cert.signature,i=extractDER(t),n=(0,eq.eV)(domain_sep("ic-state-root"),e),a=lookupResultToBuffer(this.lookup_path(["time"]));if(!a)throw S.il.fromCode(new S.XQ("Certificate does not contain a time"));if(!this.#e){let e=this.#t?.getTimeDiffMsecs()??0,t=6e4*this._maxAgeInMinutes,r=new Date,i=r.getTime()+e,n=decodeTime(a),s=n.getTime()<i-t,o=n.getTime()>i+3e5;if((s||o)&&this.#t&&!this.#t.hasSyncedTime())return await this.#t.syncTime(this._canisterId),await this.verify();if(s)throw S.Vp.fromCode(new S.rY(this._maxAgeInMinutes,n,r,e,"past"));if(o){if(this.#t?.hasSyncedTime())throw S.Ko.fromCode(new S.hu("System time has been synced with the IC network, but certificate is still too far in the future."));throw S.Vp.fromCode(new S.rY(5,n,r,e,"future"))}}try{let e=await this._blsVerify(i,r,n);if(!e)throw S.Vp.fromCode(new S.XQ("Invalid signature"))}catch(e){throw S.Vp.fromCode(new S.XQ("Signature verification failed",e))}}async _checkDelegationAndGetKey(e){if(!e)return this._rootKey;let t=Certificate.createUnverified({certificate:e.certificate,rootKey:this._rootKey,canisterId:this._canisterId,blsVerify:this._blsVerify,disableTimeVerification:this.#e,maxAgeInMinutes:43200,agent:this.#t});if(t.cert.delegation)throw S.il.fromCode(new S.K1);await t.verify();let r=e.subnet_id,i=O.R.fromUint8Array(r),n=check_canister_ranges({canisterId:this._canisterId,subnetId:i,tree:t.cert.tree});if(!n)throw S.Vp.fromCode(new S.l3(this._canisterId,i));let a=lookupResultToBuffer(t.lookup_path(["subnet",r,"public_key"]));if(!a)throw S.Vp.fromCode(new S.n6(`Could not find subnet key for subnet ID ${i.toText()}`));return a}};let tm=(0,eq.nr)("308182301d060d2b0601040182dc7c0503010201060c2b0601040182dc7c05030201036100");function extractDER(e){let t=tm.byteLength+96;if(e.byteLength!==t)throw S.il.fromCode(new S.Re(t,e.byteLength));let r=e.slice(0,tm.byteLength);if(!(0,ty.mK)(r,tm))throw S.il.fromCode(new S.Cq(tm,r));return e.slice(tm.byteLength)}function lookupResultToBuffer(e){if(e.status===p.Found&&e.value instanceof Uint8Array)return e.value}async function reconstruct(e){switch(e[0]){case h.Empty:return(0,eA.JQ)(domain_sep("ic-hashtree-empty"));case h.Pruned:return e[1];case h.Leaf:return(0,eA.JQ)((0,eq.eV)(domain_sep("ic-hashtree-leaf"),e[1]));case h.Labeled:return(0,eA.JQ)((0,eq.eV)(domain_sep("ic-hashtree-labeled"),e[1],await reconstruct(e[2])));case h.Fork:return(0,eA.JQ)((0,eq.eV)(domain_sep("ic-hashtree-fork"),await reconstruct(e[1]),await reconstruct(e[2])));default:throw S.Zf}}function domain_sep(e){let t=new Uint8Array([e.length]),r=new TextEncoder().encode(e);return(0,eq.eV)(t,r)}function pathToLabel(e){return"string"==typeof e[0]?(0,eq.iY)(e[0]):e[0]}function lookup_path(e,t){if(0===e.length)switch(t[0]){case h.Empty:return{status:p.Absent};case h.Leaf:if(!t[1])throw S.Ko.fromCode(new S.$n("Invalid tree structure for leaf"));if(t[1]instanceof Uint8Array)return{status:p.Found,value:t[1].slice(t[1].byteOffset,t[1].byteLength+t[1].byteOffset)};throw S.Zf;case h.Pruned:return{status:p.Unknown};case h.Labeled:case h.Fork:return{status:p.Error};default:throw S.Zf}let r=pathToLabel(e),i=find_label(r,t);switch(i.status){case m.Found:return lookup_path(e.slice(1),i.value);case m.Absent:case m.Greater:case m.Less:return{status:p.Absent};case m.Unknown:return{status:p.Unknown};default:throw S.Zf}}function lookup_subtree(e,t){if(0===e.length)return{status:y.Found,value:t};let r=pathToLabel(e),i=find_label(r,t);switch(i.status){case m.Found:return lookup_subtree(e.slice(1),i.value);case m.Unknown:return{status:y.Unknown};case m.Absent:case m.Greater:case m.Less:return{status:y.Absent};default:throw S.Zf}}function flatten_forks(e){switch(e[0]){case h.Empty:return[];case h.Fork:return flatten_forks(e[1]).concat(flatten_forks(e[2]));default:return[e]}}function find_label(e,t){switch(t[0]){case h.Labeled:if(isBufferGreaterThan(e,t[1]))return{status:m.Greater};if((0,ty.mK)(e,t[1]))return{status:m.Found,value:t[2]};return{status:m.Less};case h.Fork:{let r=find_label(e,t[1]);switch(r.status){case m.Greater:{let r=find_label(e,t[2]);if(r.status===m.Less)return{status:m.Absent};return r}case m.Unknown:{let r=find_label(e,t[2]);if(r.status===m.Less)return{status:m.Unknown};return r}default:return r}}case h.Pruned:return{status:m.Unknown};default:return{status:m.Absent}}}function check_canister_ranges(e){let{canisterId:t,subnetId:r,tree:i}=e,n=lookup_path(["subnet",r.toUint8Array(),"canister_ranges"],i);if(n.status!==p.Found)throw S.il.fromCode(new S.SZ(`Could not find canister ranges for subnet ${r.toText()}`,n.status));if(!(n.value instanceof Uint8Array))throw S.il.fromCode(new S.Ys(`Could not find canister ranges for subnet ${r.toText()}`));let a=cbor_decode(n.value),s=a.map(e=>[O.R.fromUint8Array(e[0]),O.R.fromUint8Array(e[1])]),o=s.some(e=>e[0].ltEq(t)&&e[1].gtEq(t));return o}function defaultStrategy(){return chain(conditionalDelay(once(),1e3),backoff(1e3,1.2),timeout(3e5))}function once(){let e=!0;return async()=>!!e&&(e=!1,!0)}function conditionalDelay(e,t){return async(r,i,n)=>{if(await e(r,i,n))return new Promise(e=>setTimeout(e,t))}}function timeout(e){let t=Date.now()+e;return async(r,i,n)=>{if(Date.now()>t)throw S.il.fromCode(new S.uo(`Request timed out after ${e} msec`,i,n))}}function backoff(e,t){let r=e;return()=>new Promise(e=>setTimeout(()=>{r*=t,e()},r))}function chain(...e){return async(t,r,i)=>{for(let n of e)await n(t,r,i)}}(function(e){e.Unknown="Unknown",e.Absent="Absent",e.Found="Found",e.Error="Error"})(p||(p={})),function(e){e.Absent="Absent",e.Unknown="Unknown",e.Found="Found"}(y||(y={})),function(e){e.Absent="Absent",e.Unknown="Unknown",e.Found="Found",e.Less="Less",e.Greater="Greater"}(m||(m={}));var tb=r(52),tg=r(9382);let request=async e=>{let{agent:t,paths:r,disableCertificateTimeVerification:i=!1}=e,n=O.R.from(e.canisterId),a=[...new Set(r)],s=new Map,o=a.map((e,r)=>{let o=encodePath(e,n);return(async()=>{try{if(null===t.rootKey)throw S.Ej.fromCode(new S.PG);let e=t.rootKey,c=await t.readState(n,{paths:[o]}),l=await Certificate.create({certificate:c.certificate,rootKey:e,canisterId:n,disableTimeVerification:i,agent:t}),{path:u,data:d}=((t,r)=>{if("subnet"!==r)return{path:r,data:lookupResultToBuffer(t.lookup_path(o))};{let t=fetchNodeKeys(c.certificate,n,e);return{path:r,data:t}}})(l,a[r]);if(d)switch(u){case"time":s.set(u,decodeTime(d));break;case"controllers":s.set(u,decodeControllers(d));break;case"module_hash":s.set(u,(0,eq.ci)(d));break;case"subnet":s.set(u,d);break;case"candid":s.set(u,new TextDecoder().decode(d));break;default:if("string"!=typeof u&&"key"in u&&"path"in u)switch(u.decodeStrategy){case"raw":s.set(u.key,d);break;case"leb128":s.set(u.key,decodeLeb128(d));break;case"cbor":s.set(u.key,cbor_decode(d));break;case"hex":s.set(u.key,(0,eq.ci)(d));break;case"utf-8":s.set(u.key,new TextDecoder().decode(d))}}else console.warn(`Expected to find result for path ${u}, but instead found nothing.`),"string"==typeof u?s.set(u,null):s.set(u.key,null)}catch(t){if(t instanceof S.e$&&(t.hasCode(S.XQ)||t.hasCode(S.rY)))throw t;"string"!=typeof e&&"key"in e&&"path"in e?s.set(e.key,null):s.set(e,null),console.group(),console.warn(`Expected to find result for path ${e}, but instead found nothing.`),console.warn(t),console.groupEnd()}})()});return await Promise.all(o),s},fetchNodeKeys=(e,t,r)=>{let i;if(!t._isPrincipal)throw S.pd.fromCode(new S.hu("Invalid canisterId"));let n=cbor_decode(e),a=n.tree,s=n.delegation;s&&s.subnet_id?i=O.R.fromUint8Array(new Uint8Array(s.subnet_id)):s=s||void 0===r?{subnet_id:(i=O.R.selfAuthenticating(O.R.fromText("tdb26-jop6k-aogll-7ltgs-eruif-6kk7m-qpktf-gdiqx-mxtrf-vb5e6-eqe").toUint8Array())).toUint8Array(),certificate:new Uint8Array(0)}:{subnet_id:(i=O.R.selfAuthenticating(new Uint8Array(r))).toUint8Array(),certificate:new Uint8Array(0)};let o=check_canister_ranges({canisterId:t,subnetId:i,tree:a});if(!o)throw S.Vp.fromCode(new S.l3(t,i));let c=lookup_subtree(["subnet",s.subnet_id,"node"],a);if(c.status!==y.Found)throw S.il.fromCode(new S.SZ("Node not found",c.status));if(c.value instanceof Uint8Array)throw S.Ko.fromCode(new S.$n("Invalid node tree"));let l=flatten_forks(c.value),u=new Map;return l.forEach(e=>{let t=O.R.from(e[1]).toText(),r=lookup_path(["public_key"],e[2]);if(r.status!==p.Found)throw S.il.fromCode(new S.SZ("Public key not found",r.status));let i=r.value;if(44!==i.byteLength)throw S.il.fromCode(new S.Re(44,i.byteLength));u.set(t,i)}),{subnetId:O.R.fromUint8Array(new Uint8Array(s.subnet_id)).toText(),nodeKeys:u}},encodePath=(e,t)=>{let r=t.toUint8Array();switch(e){case"time":return[(0,eq.iY)("time")];case"controllers":return[(0,eq.iY)("canister"),r,(0,eq.iY)("controllers")];case"module_hash":return[(0,eq.iY)("canister"),r,(0,eq.iY)("module_hash")];case"subnet":return[(0,eq.iY)("subnet")];case"candid":return[(0,eq.iY)("canister"),r,(0,eq.iY)("metadata"),(0,eq.iY)("candid:service")];default:if("key"in e&&"path"in e){if(!("string"==typeof e.path||e.path instanceof Uint8Array))return e.path;{let t=e.path,i="string"==typeof t?(0,eq.iY)(t):t;return[(0,eq.iY)("canister"),r,(0,eq.iY)("metadata"),i]}}}throw S.Ko.fromCode(new S.hu(`Error while encoding your path for canister status. Please ensure that your path ${e} was formatted correctly.`))},decodeControllers=e=>{let t=cbor_decode(e);return t.map(e=>O.R.fromUint8Array(e))};var tw=r(2961);let ExpirableMap=class ExpirableMap{static{g=Symbol.iterator,v=Symbol.toStringTag}#r;#i;constructor(e={}){this[g]=this.entries.bind(this),this[v]="ExpirableMap";let{source:t=[],expirationTime:r=6e5}=e,i=Date.now();this.#r=new Map([...t].map(([e,t])=>[e,{value:t,timestamp:i}])),this.#i=r}prune(){let e=Date.now();for(let[t,r]of this.#r.entries())e-r.timestamp>this.#i&&this.#r.delete(t);return this}set(e,t){this.prune();let r={value:t,timestamp:Date.now()};return this.#r.set(e,r),this}get(e){let t=this.#r.get(e);if(void 0!==t){if(Date.now()-t.timestamp>this.#i){this.#r.delete(e);return}return t.value}}clear(){this.#r.clear()}entries(){let e=this.#r.entries(),generator=function*(){for(let[t,r]of e)yield[t,r.value]};return generator()}values(){let e=this.#r.values(),generator=function*(){for(let t of e)yield t.value};return generator()}keys(){return this.#r.keys()}forEach(e,t){for(let[r,i]of this.#r.entries())e.call(t,i.value,r,this)}has(e){return this.#r.has(e)}delete(e){return this.#r.delete(e)}get size(){return this.#r.size}};var t_=r(6541);let Ed25519PublicKey=class Ed25519PublicKey{static from(e){return this.fromDer(e.toDer())}static fromRaw(e){return new Ed25519PublicKey(e)}static fromDer(e){return new Ed25519PublicKey(this.derDecode(e))}static{this.RAW_KEY_LENGTH=32}static derEncode(e){return(0,t_.nt)(e,t_.BM)}static derDecode(e){let t=(0,t_.eZ)(e,t_.BM);if(t.length!==this.RAW_KEY_LENGTH)throw S.pd.fromCode(new S.mx("An Ed25519 public key must be exactly 32 bytes long"));return t}#n;get rawKey(){return this.#n}#a;get derKey(){return this.#a}constructor(e){if(e.byteLength!==Ed25519PublicKey.RAW_KEY_LENGTH)throw S.pd.fromCode(new S.mx("An Ed25519 public key must be exactly 32 bytes long"));this.#n=e,this.#a=Ed25519PublicKey.derEncode(e)}toDer(){return this.derKey}toRaw(){return this.rawKey}};let Observable=class Observable{constructor(){this.observers=[]}subscribe(e){this.observers.push(e)}unsubscribe(e){this.observers=this.observers.filter(t=>t!==e)}notify(e,...t){this.observers.forEach(r=>r(e,...t))}};let ObservableLog=class ObservableLog extends Observable{constructor(){super()}print(e,...t){this.notify({message:e,level:"info"},...t)}warn(e,...t){this.notify({message:e,level:"warn"},...t)}error(e,t,...r){this.notify({message:e,level:"error",error:t},...r)}};let ExponentialBackoff=class ExponentialBackoff{#s;#o;#c;#l;#u;#d;#f;#h;#p=0;static{this.default={initialInterval:500,randomizationFactor:.5,multiplier:1.5,maxInterval:6e4,maxElapsedTime:9e5,maxIterations:10,date:Date}}constructor(e=ExponentialBackoff.default){let{initialInterval:t=500,randomizationFactor:r=.5,multiplier:i=1.5,maxInterval:n=6e4,maxElapsedTime:a=9e5,maxIterations:s=10,date:o=Date}=e;this.#s=t,this.#o=r,this.#c=i,this.#l=n,this.#h=o,this.#u=o.now(),this.#d=a,this.#f=s}get ellapsedTimeInMsec(){return this.#h.now()-this.#u}get currentInterval(){return this.#s}get count(){return this.#p}get randomValueFromInterval(){let e=this.#o*this.#s,t=this.#s-e,r=this.#s+e;return Math.random()*(r-t)+t}incrementCurrentInterval(){return this.#s=Math.min(this.#s*this.#c,this.#l),this.#p++,this.#s}next(){return this.ellapsedTimeInMsec>=this.#d||this.#p>=this.#f?null:(this.incrementCurrentInterval(),this.randomValueFromInterval)}};var tv=r(8423);function getDefaultFetch(){let e;if("undefined"!=typeof window){if(window.fetch)e=window.fetch.bind(window);else throw S.Ej.fromCode(new S.pX("Fetch implementation was not available. You appear to be in a browser context, but window.fetch was not present."))}else if("undefined"!=typeof global){if(global.fetch)e=global.fetch.bind(global);else throw S.Ej.fromCode(new S.pX("Fetch implementation was not available. You appear to be in a Node.js context, but global.fetch was not available."))}else"undefined"!=typeof self&&self.fetch&&(e=self.fetch.bind(self));if(e)return e;throw S.Ej.fromCode(new S.pX("Fetch implementation was not available. Please provide fetch to the HttpAgent constructor, or ensure it is available in the window or global context."))}function determineHost(e){let t;if(void 0!==e)t=new URL(e.match(/^[a-z]+:/)||"undefined"==typeof window?e:window.location.protocol+"//"+e);else{let e;let r="undefined"!=typeof window?window.location:void 0,i=r?.hostname;i&&"string"==typeof i&&(e=[".github.dev",".gitpod.io"].some(e=>i.endsWith(e))?i:["ic0.app","icp0.io","127.0.0.1","localhost"].find(e=>i.endsWith(e))),t=new URL(r&&e?`${r.protocol}//${e}${r.port?":"+r.port:""}`:"https://icp-api.io")}return t.toString()}!function(e){e.Received="received",e.Processing="processing",e.Replied="replied",e.Rejected="rejected",e.Unknown="unknown",e.Done="done"}(T||(T={}));let HttpAgent=class HttpAgent{#y;#m;#b;#g;#w;#_;#v;#E;#T;#C;#x;#I;#B;#S;get #R(){return 6e4*this.#S}#N;#O;#F;#V;constructor(e={}){this.#y=null,this.#m=!1,this.#b=0,this.#g=!1,this.#w=null,this.#_=!1,this._isAgent=!0,this.config={},this.log=new ObservableLog,this.#N=[],this.#O=[],this.#F=new ExpirableMap({expirationTime:3e5}),this.#V=!0,this.#P=(e,t)=>{if(!1===this.#V)return e;let{status:r,signatures:i=[],requestId:n}=e;for(let a of i){let i;let{timestamp:s,identity:c}=a,l=O.R.fromUint8Array(c).toText();if(r===o.Replied){let{reply:t}=e;i=(0,tg.E$)({status:r,reply:t,timestamp:BigInt(s),request_id:n})}else if(r===o.Rejected){let{reject_code:t,reject_message:a,error_code:o}=e;i=(0,tg.E$)({status:r,reject_code:t,reject_message:a,error_code:o,timestamp:BigInt(s),request_id:n})}else throw S.Ko.fromCode(new S.hu(`Unknown status: ${r}`));let u=(0,eq.eV)(tv.Nz,i),d=t.nodeKeys.get(l);if(!d)throw S.il.fromCode(new S.JU);let f=Ed25519PublicKey.fromDer(d).rawKey,h=tw.UN.verify(a.signature,u,f);if(h)break;throw S.Vp.fromCode(new S.Q7(l))}return e},this.config=e,this.#E=e.fetch||getDefaultFetch()||fetch.bind(global),this.#T=e.fetchOptions,this.#C=e.callOptions,this.#m=e.shouldFetchRootKey??!1,this.#_=e.shouldSyncTime??!1,e.rootKey?this.rootKey=e.rootKey:this.#m?this.rootKey=null:this.rootKey=(0,eq.nr)("308182301d060d2b0601040182dc7c0503010201060c2b0601040182dc7c05030201036100814c0e6ec71fab583b08bd81373c255c3c371b2e84863c98a4f1e08b74235d14fb5d9c0cd546d9685f913a0c0b2cc5341583bf4b4392e467db96d65b9bb4cb717112f8472e0d5a4d14505ffd7484b01291091c5f87b98883463f98091a0baaae");let t=determineHost(e.host);if(this.host=new URL(t),void 0!==e.verifyQuerySignatures&&(this.#V=e.verifyQuerySignatures),this.#I=e.retryTimes??3,this.#B=e.backoffStrategy||(()=>new ExponentialBackoff({maxIterations:this.#I})),this.host.hostname.endsWith(".ic0.app")?this.host.hostname="ic0.app":this.host.hostname.endsWith(".icp0.io")?this.host.hostname="icp0.io":this.host.hostname.endsWith(".icp-api.io")&&(this.host.hostname="icp-api.io"),e.credentials){let{name:t,password:r}=e.credentials;this.#x=`${t}${r?":"+r:""}`}if(this.#v=Promise.resolve(e.identity||new tb.ed),e.ingressExpiryInMinutes&&e.ingressExpiryInMinutes>5)throw S.pd.fromCode(new S.k6("The maximum ingress expiry time is 5 minutes.",e.ingressExpiryInMinutes));if(e.ingressExpiryInMinutes&&e.ingressExpiryInMinutes<=0)throw S.pd.fromCode(new S.k6("Ingress expiry time must be greater than 0.",e.ingressExpiryInMinutes));this.#S=e.ingressExpiryInMinutes||5,this.addTransform("update",makeNonceTransform(makeNonce)),e.useQueryNonces&&this.addTransform("query",makeNonceTransform(makeNonce)),e.logToConsole&&this.log.subscribe(e=>{"error"===e.level?console.error(e.message):"warn"===e.level?console.warn(e.message):console.log(e.message)})}static createSync(e={}){return new this({...e})}static async create(e={}){let t=HttpAgent.createSync(e);return await t.#A(),t}static async from(e){try{if("config"in e)return await HttpAgent.create(e.config);return await HttpAgent.create({fetch:e._fetch,fetchOptions:e._fetchOptions,callOptions:e._callOptions,host:e._host.toString(),identity:e._identity??void 0})}catch{throw S.pd.fromCode(new S.wb)}}isLocal(){let e=this.host.hostname;return"127.0.0.1"===e||e.endsWith("127.0.0.1")}addTransform(e,t,r=t.priority||0){if("update"===e){let e=this.#O.findIndex(e=>(e.priority||0)<r);this.#O.splice(e>=0?e:this.#O.length,0,Object.assign(t,{priority:r}))}else if("query"===e){let e=this.#N.findIndex(e=>(e.priority||0)<r);this.#N.splice(e>=0?e:this.#N.length,0,Object.assign(t,{priority:r}))}}async getPrincipal(){if(!this.#v)throw S.Ej.fromCode(new S._S);return(await this.#v).getPrincipal()}async call(e,t,r){let i;let n=t.callSync??!0,a=await (r??this.#v);if(!a)throw S.Ej.fromCode(new S._S);let s=O.R.from(e),o=t.effectiveCanisterId?O.R.from(t.effectiveCanisterId):s;await this.#A(o);let c=a.getPrincipal(),l=calculateIngressExpiry(this.#S,this.#b),f={request_type:d.Call,canister_id:s,method_name:t.methodName,arg:t.arg,sender:c,ingress_expiry:l},h=await this._transform({request:{body:null,method:"POST",headers:{"Content-Type":"application/cbor",...this.#x?{Authorization:"Basic "+btoa(this.#x)}:{}}},endpoint:u.Call,body:f});function toNonce(e){return Object.assign(e,{__nonce__:void 0})}i=t?.nonce?toNonce(t.nonce):h.body.nonce?toNonce(h.body.nonce):void 0,f.nonce=i,h=await a.transformRequest(h);let p=cbor_encode(h.body),y=this.#B(),m=(0,tg.vH)(f);try{let e=n?()=>(this.log.print(`fetching "/api/v3/canister/${o.toText()}/call" with request:`,h),this.#E(""+new URL(`/api/v3/canister/${o.toText()}/call`,this.host),{...this.#C,...h.request,body:p})):()=>(this.log.print(`fetching "/api/v2/canister/${o.toText()}/call" with request:`,h),this.#E(""+new URL(`/api/v2/canister/${o.toText()}/call`,this.host),{...this.#C,...h.request,body:p})),{responseBodyBytes:t,...r}=await this.#k({requestFn:e,backoff:y,tries:0}),i=t.byteLength>0?cbor_decode(t):null;return{requestId:m,response:{...r,body:i},requestDetails:f}}catch(n){let i;if(n instanceof S.e$){if(n.hasCode(S.l))return this.log.warn("v3 api not supported. Fall back to v2"),this.call(e,{...t,callSync:!1},r);if(n.hasCode(S.k6)&&!this.#g)return await this.syncTime(s),this.call(s,t,r);n.code.requestContext={requestId:m,senderPubKey:h.body.sender_pubkey,senderSignature:h.body.sender_sig,ingressExpiry:h.body.content.ingress_expiry},i=n}else i=S.Ko.fromCode(new S.hu(n));throw this.log.error(`Error while making call: ${i.message}`,i),i}}async #q(e){let t;let{ecid:r,transformedRequest:i,body:n,requestId:a,backoff:s,tries:o}=e,c=0===o?0:s.next();if(this.log.print(`fetching "/api/v2/canister/${r.toString()}/query" with tries:`,{tries:o,backoff:s,delay:c}),null===c)throw S.Ko.fromCode(new S.uo(`Backoff strategy exhausted after ${o} attempts.`,a));c>0&&await new Promise(e=>setTimeout(e,c));try{this.log.print(`fetching "/api/v2/canister/${r.toString()}/query" with request:`,i);let e=await this.#E(""+new URL(`/api/v2/canister/${r.toString()}/query`,this.host),{...this.#T,...i.request,body:n});if(200===e.status){let r=cbor_decode((0,ty.ZP)(await e.arrayBuffer()));t={...r,httpDetails:{ok:e.ok,status:e.status,statusText:e.statusText,headers:httpHeadersTransform(e.headers)},requestId:a}}else throw S.il.fromCode(new S.PK(e.status,e.statusText,httpHeadersTransform(e.headers),await e.text()))}catch(t){if(o<this.#I)return this.log.warn(`Caught exception while attempting to make query:
  ${t}
  Retrying query.`),await this.#q({...e,tries:o+1});if(t instanceof S.e$)throw t;throw S.PS.fromCode(new S.pi(t))}if(!this.#V)return t;let l=t.signatures?.[0]?.timestamp;if(!l)throw S.il.fromCode(new S.bL("Timestamp not found in query response. This suggests a malformed or malicious response."));let u=Number(BigInt(l)/BigInt(1e6)),d=Date.now()+this.#b;if(d-u>this.#R){if(o<this.#I)return this.log.warn("Timestamp is older than the max ingress expiry. Retrying query.",{requestId:a,signatureTimestampMs:u}),await this.#q({...e,tries:o+1});throw S.Vp.fromCode(new S.wq(this.#S,a,o))}return t}async #k(e){let t;let{requestFn:r,backoff:i,tries:n}=e,a=0===n?0:i.next();if(null===a)throw S.il.fromCode(new S.uo(`Retry strategy exhausted after ${n} attempts.`));a>0&&await new Promise(e=>setTimeout(e,a));let s=new Uint8Array;try{200===(t=await r()).status&&(s=(0,ty.ZP)(await t.clone().arrayBuffer()))}catch(e){if(n<this.#I)return this.log.warn(`Caught exception while attempting to make request:
  ${e}
  Retrying request.`),await this.#k({requestFn:r,backoff:i,tries:n+1});throw S.PS.fromCode(new S.pi(e))}let o=httpHeadersTransform(t.headers);if(200===t.status||202===t.status)return{ok:t.ok,status:t.status,statusText:t.statusText,responseBodyBytes:s,headers:o};let c=await t.text();if(404===t.status&&t.url.includes("api/v3"))throw S.il.fromCode(new S.l);if(c.startsWith("Invalid request expiry: "))throw S.pd.fromCode(new S.k6(c,this.#S));if(n<this.#I)return await this.#k({requestFn:r,backoff:i,tries:n+1});throw S.il.fromCode(new S.PK(t.status,t.statusText,o,c))}async query(e,t,r){let i;let n=this.#B(),a=t.effectiveCanisterId?O.R.from(t.effectiveCanisterId):O.R.from(e);await this.#A(a),this.log.print(`ecid ${a.toString()}`),this.log.print(`canisterId ${e.toString()}`);let s=await (r??this.#v);if(!s)throw S.Ej.fromCode(new S._S);let o=O.R.from(e),c=s.getPrincipal(),l=calculateIngressExpiry(this.#S,this.#b),d={request_type:f.Query,canister_id:o,method_name:t.methodName,arg:t.arg,sender:c,ingress_expiry:l},h=(0,tg.vH)(d);i=await this._transform({request:{method:"POST",headers:{"Content-Type":"application/cbor",...this.#x?{Authorization:"Basic "+btoa(this.#x)}:{}}},endpoint:u.Query,body:d}),i=await s.transformRequest(i);let p=cbor_encode(i.body),y={canister:o.toText(),ecid:a,transformedRequest:i,body:p,requestId:h,backoff:n,tries:0},makeQuery=async()=>{let e=await this.#q(y);return{requestDetails:d,...e}},getSubnetStatus=async()=>{let e=this.#F.get(a.toString());if(e)return e;await this.fetchSubnetKeys(a.toString());let t=this.#F.get(a.toString());if(!t)throw S.Vp.fromCode(new S.Bp);return t};try{if(!this.#V)return await makeQuery();let[e,t]=await Promise.all([makeQuery(),getSubnetStatus()]);try{return this.#P(e,t)}catch{this.log.warn("Query response verification failed. Retrying with fresh subnet keys."),this.#F.delete(a.toString());let t=await getSubnetStatus();return this.#P(e,t)}}catch(t){let e;throw t instanceof S.e$?(t.code.requestContext={requestId:h,senderPubKey:i.body.sender_pubkey,senderSignature:i.body.sender_sig,ingressExpiry:i.body.content.ingress_expiry},e=t):e=S.Ko.fromCode(new S.hu(t)),this.log.error(`Error while making query: ${e.message}`,e),e}}#P;async createReadStateRequest(e,t){await this.#A();let r=await (t??this.#v);if(!r)throw S.Ej.fromCode(new S._S);let i=r.getPrincipal(),n=await this._transform({request:{method:"POST",headers:{"Content-Type":"application/cbor",...this.#x?{Authorization:"Basic "+btoa(this.#x)}:{}}},endpoint:u.ReadState,body:{request_type:f.ReadState,paths:e.paths,sender:i,ingress_expiry:calculateIngressExpiry(this.#S,this.#b)}});return r.transformRequest(n)}async readState(e,t,r,i){let n,a;await this.#U();let s=O.R.from(e);function getRequestId(e){for(let t of e.paths){let[e,r]=t,i=new TextEncoder().encode("request_status");if((0,ty.mK)(e,i))return r}}if(i)n=i,a=(0,tg.vH)(n);else{a=getRequestId(t);let e=await this.#v;if(!e)throw S.Ej.fromCode(new S._S);n=await this.createReadStateRequest(t,e)}this.log.print(`fetching "/api/v2/canister/${s}/read_state" with request:`,n);let o=this.#B();try{let{responseBodyBytes:e}=await this.#k({requestFn:()=>this.#E(""+new URL(`/api/v2/canister/${s.toString()}/read_state`,this.host),{...this.#T,...n.request,body:cbor_encode(n.body)}),backoff:o,tries:0}),t=cbor_decode(e);return this.log.print("Read state response:",t),t}catch(t){let e;throw t instanceof S.e$?(t.code.requestContext={requestId:a,senderPubKey:n.body.sender_pubkey,senderSignature:n.body.sender_sig,ingressExpiry:n.body.content.ingress_expiry},e=t):e=S.Ko.fromCode(new S.hu(t)),this.log.error(`Error while making read state: ${e.message}`,e),e}}parseTimeFromResponse(e){let t;if(e.certificate){let r=cbor_decode(e.certificate);if(r&&"tree"in r)t=r.tree;else throw S.il.fromCode(new S.$n("Could not decode time from response"));let i=lookup_path(["time"],t);if(i.status!==p.Found)throw S.il.fromCode(new S.SZ("Time was not found in the response or was not in its expected format.",i.status));if(!(i.value instanceof Uint8Array)&&!ArrayBuffer.isView(i))throw S.il.fromCode(new S.Ys("Time was not in its expected format."));let n=decodeTime(i.value);return this.log.print("Time from response:",n),this.log.print("Time from response in milliseconds:",n.getTime()),n.getTime()}return this.log.warn("No certificate found in response"),0}async syncTime(e){this.#w=this.#w??(async()=>{await this.#U();let t=Date.now();try{e||this.log.print("Syncing time with the IC. No canisterId provided, so falling back to ryjl3-tyaaa-aaaaa-aaaba-cai");let r=e??O.R.from("ryjl3-tyaaa-aaaaa-aaaba-cai"),i=HttpAgent.createSync({identity:new tb.ed,host:this.host.toString(),fetch:this.#E,retryTimes:0,rootKey:this.rootKey??void 0,shouldSyncTime:!1}),n=await Promise.all([,,,].fill(null).map(async()=>{let e=await request({canisterId:r,agent:i,paths:["time"],disableCertificateTimeVerification:!0}),t=e.get("time");if(t instanceof Date)return t.getTime()},[])),a=n.reduce((e,t)=>"number"==typeof t&&t>e?t:e,0);a>0&&(this.#b=a-t,this.#g=!0,this.log.notify({message:`Syncing time: offset of ${this.#b}`,level:"info"}))}catch(t){let e=t instanceof S.e$?t:S.Ko.fromCode(new S.hu(t));throw this.log.error("Caught exception while attempting to sync time",e),e}})(),await this.#w.finally(()=>{this.#w=null})}async status(){let e=this.#x?{Authorization:"Basic "+btoa(this.#x)}:{};this.log.print('fetching "/api/v2/status"');let t=this.#B(),{responseBodyBytes:r}=await this.#k({backoff:t,requestFn:()=>this.#E(""+new URL("/api/v2/status",this.host),{headers:e,...this.#T}),tries:0});return cbor_decode(r)}async fetchRootKey(){return this.#y=this.#y??(async()=>{let e=await this.status();return this.rootKey=e.root_key,this.rootKey})(),await this.#y.finally(()=>{this.#y=null})}async #A(e){await Promise.all([this.#U(),this.#D(e)])}async #U(){if(!this.rootKey){if(null===this.rootKey&&"https://icp-api.io"!==this.host.toString()&&this.#m)await this.fetchRootKey();else throw S.Ej.fromCode(new S.PG(this.#m))}}async #D(e){this.#_&&!this.hasSyncedTime()&&await this.syncTime(e)}invalidateIdentity(){this.#v=null}replaceIdentity(e){this.#v=Promise.resolve(e)}async fetchSubnetKeys(e){let t=O.R.from(e);await this.#A(t);let r=await request({canisterId:t,paths:["subnet"],agent:this}),i=r.get("subnet");if(i&&"object"==typeof i&&"nodeKeys"in i)return this.#F.set(t.toText(),i),i}_transform(e){let t=Promise.resolve(e);if(e.endpoint===u.Call)for(let e of this.#O)t=t.then(t=>e(t).then(e=>e||t));else for(let e of this.#N)t=t.then(t=>e(t).then(e=>e||t));return t}getTimeDiffMsecs(){return this.#b}hasSyncedTime(){return this.#g}};function calculateIngressExpiry(e,t){return Expiry.fromDeltaInMilliseconds(6e4*e,t)}function hasProperty(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function isObjectWithProperty(e,t){return null!==e&&"object"==typeof e&&hasProperty(e,t)}function hasFunction(e,t){return hasProperty(e,t)&&"function"==typeof e[t]}function isSignedReadStateRequestWithExpiry(e){return isObjectWithProperty(e,"body")&&isObjectWithProperty(e.body,"content")&&e.body.content.request_type===f.ReadState&&isObjectWithProperty(e.body.content,"ingress_expiry")&&"object"==typeof e.body.content.ingress_expiry&&null!==e.body.content.ingress_expiry&&hasFunction(e.body.content.ingress_expiry,"toHash")}async function pollForResponse(e,t,r,i={}){let n,a,s;let o=[(0,eq.iY)("request_status"),r],c=i.preSignReadStateRequest??!1;if(c?(a=await constructRequest({paths:[o],agent:e,pollingOptions:i}),n=await e.readState(t,{paths:[o]},void 0,a)):n=await e.readState(t,{paths:[o]}),null==e.rootKey)throw S.Ej.fromCode(new S.PG);let l=await Certificate.create({certificate:n.certificate,rootKey:e.rootKey,canisterId:t,blsVerify:i.blsVerify,agent:e}),u=lookupResultToBuffer(l.lookup_path([...o,(0,eq.iY)("status")]));switch(s=void 0===u?T.Unknown:new TextDecoder().decode(u)){case T.Replied:return{reply:lookupResultToBuffer(l.lookup_path([...o,"reply"])),certificate:l};case T.Received:case T.Unknown:case T.Processing:{let n=i.strategy??defaultStrategy();return await n(t,r,s),pollForResponse(e,t,r,{...i,strategy:n,request:a})}case T.Rejected:{let e=new Uint8Array(lookupResultToBuffer(l.lookup_path([...o,"reject_code"])))[0],t=new TextDecoder().decode(lookupResultToBuffer(l.lookup_path([...o,"reject_message"]))),i=lookupResultToBuffer(l.lookup_path([...o,"error_code"])),n=i?new TextDecoder().decode(i):void 0;throw S.J7.fromCode(new S.dw(r,e,t,n))}case T.Done:throw S.Ko.fromCode(new S.cG(r))}throw S.Zf}async function constructRequest(e){let{paths:t,agent:r,pollingOptions:i}=e;if(i.request&&isSignedReadStateRequestWithExpiry(i.request))return i.request;let n=await r.createReadStateRequest?.({paths:t},void 0);if(!isSignedReadStateRequestWithExpiry(n))throw S.pd.fromCode(new S.Oy(n));return n}let tE=Symbol.for("ic-agent-metadata");let Actor=class Actor{static agentOf(e){return e[tE].config.agent}static interfaceOf(e){return e[tE].service}static canisterIdOf(e){return O.R.from(e[tE].config.canisterId)}static createActorClass(e,t){let r=e({IDL:C});let CanisterActor=class CanisterActor extends Actor{constructor(e){if(!e.canisterId)throw S.pd.fromCode(new S.UY(e.canisterId));let i="string"==typeof e.canisterId?O.R.fromText(e.canisterId):e.canisterId;for(let[n,a]of(super({config:{...tT,...e,canisterId:i},service:r}),r._fields))t?.httpDetails&&a.annotations.push(tC),t?.certificate&&a.annotations.push(tx),this[n]=_createActorMethod(this,n,a,e.blsVerify)}};return CanisterActor}static createActor(e,t){if(!t.canisterId)throw S.pd.fromCode(new S.UY(t.canisterId));return new(this.createActorClass(e))(t)}static createActorWithHttpDetails(e,t){return new(this.createActorClass(e,{httpDetails:!0}))(t)}static createActorWithExtendedDetails(e,t,r={httpDetails:!0,certificate:!0}){return new(this.createActorClass(e,r))(t)}constructor(e){this[tE]=Object.freeze(e)}};function decodeReturnValue(e,t){let r=decode(e,t);switch(r.length){case 0:return;case 1:return r[0];default:return r}}let tT={pollingOptions:{preSignReadStateRequest:!1}},tC="http-details",tx="certificate";function _createActorMethod(e,t,r,i){let n;n=r.annotations.includes("query")||r.annotations.includes("composite_query")?async(i,...n)=>{i={...i,...e[tE].config.queryTransform?.(t,n,{...e[tE].config,...i})};let a=i.agent||e[tE].config.agent||new HttpAgent,s=O.R.from(i.canisterId||e[tE].config.canisterId),c=encode(r.argTypes,n),l=await a.query(s,{methodName:t,arg:c,effectiveCanisterId:i.effectiveCanisterId}),u={...l.httpDetails,requestDetails:l.requestDetails};switch(l.status){case o.Rejected:{let e=new S.gY(l.requestId,l.reject_code,l.reject_message,l.error_code,l.signatures);throw e.callContext={canisterId:s,methodName:t,httpDetails:u},S.J7.fromCode(e)}case o.Replied:return r.annotations.includes(tC)?{httpDetails:u,result:decodeReturnValue(r.retTypes,l.reply.arg)}:decodeReturnValue(r.retTypes,l.reply.arg)}}:async(n,...a)=>{let s,o;n={...n,...e[tE].config.callTransform?.(t,a,{...e[tE].config,...n})};let c=n.agent||e[tE].config.agent||HttpAgent.createSync(),{canisterId:l,effectiveCanisterId:u,pollingOptions:d}={...tT,...e[tE].config,...n},f=O.R.from(l),h=void 0!==u?O.R.from(u):f,p=encode(r.argTypes,a),{requestId:y,response:m,requestDetails:g}=await c.call(f,{methodName:t,arg:p,effectiveCanisterId:h,nonce:n.nonce});if(isV3ResponseBody(m.body)){if(null==c.rootKey)throw S.Ej.fromCode(new S.PG);let e=m.body.certificate;o=await Certificate.create({certificate:e,rootKey:c.rootKey,canisterId:h,blsVerify:i,agent:c});let r=[(0,eq.iY)("request_status"),y],n=new TextDecoder().decode(lookupResultToBuffer(o.lookup_path([...r,"status"])));switch(n){case"replied":s=lookupResultToBuffer(o.lookup_path([...r,"reply"]));break;case"rejected":{let e=new Uint8Array(lookupResultToBuffer(o.lookup_path([...r,"reject_code"])))[0],i=new TextDecoder().decode(lookupResultToBuffer(o.lookup_path([...r,"reject_message"]))),n=lookupResultToBuffer(o.lookup_path([...r,"error_code"])),a=n?new TextDecoder().decode(n):void 0,s=new S.dw(y,e,i,a);throw s.callContext={canisterId:f,methodName:t,httpDetails:m},S.J7.fromCode(s)}}}else if(isV2ResponseBody(m.body)){let{reject_code:e,reject_message:r,error_code:i}=m.body,n=new S.hM(y,e,r,i);throw n.callContext={canisterId:f,methodName:t,httpDetails:m},S.J7.fromCode(n)}if(202===m.status){let e={...d,blsVerify:i},t=await pollForResponse(c,h,y,e);o=t.certificate,s=t.reply}let v=r.annotations.includes(tC),T=r.annotations.includes(tx),C={...m,requestDetails:g};if(void 0!==s)return v&&T?{httpDetails:C,certificate:o,result:decodeReturnValue(r.retTypes,s)}:T?{certificate:o,result:decodeReturnValue(r.retTypes,s)}:v?{httpDetails:C,result:decodeReturnValue(r.retTypes,s)}:decodeReturnValue(r.retTypes,s);{let e=new S.hu(`Call was returned undefined. We cannot determine if the call was successful or not. Return types: [${r.retTypes.map(e=>e.display()).join(",")}].`);throw e.callContext={canisterId:f,methodName:t,httpDetails:C},S.Ko.fromCode(e)}};let handler=(...e)=>n({},...e);return handler.withOptions=e=>(...t)=>n(e,...t),handler}}};